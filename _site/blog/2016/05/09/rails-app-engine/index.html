<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <title> First Impressions: Rails 5 on Google App Engine </title> <meta name="description" content="In this post I've been playing around with Google App Engine, trying to release a simple Rails 5 app, reading logs or setting environment variables. I also attempted a very non-scientific performance benchmark to compare Heroku with the App Engine."> <meta name="author" content="Marc G Gauthier"> <meta content='user-scalable=no, width=device-width, initial-scale=1.0' name='viewport'> <meta name="google-site-verification" content="x2EpQdOMz-k9fP8hak9I3COaXhnQ4jNLp2GU4GYQ8jM" /> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:site" content="@marcgg"> <meta name="twitter:creator" content="@marcgg"> <meta name="twitter:title" content="First Impressions: Rails 5 on Google App Engine"> <meta name="twitter:description" content="In this post I've been playing around with Google App Engine, trying to release a simple Rails 5 app, reading logs or setting environment variables. I also attempted a very non-scientific performance benchmark to compare Heroku with the App Engine."> <meta name="twitter:image" content="https://marcgg.com/assets/previews/2016-05-09-rails-app-engine.jpg" /> <meta name="image" property="og:image" content="https://marcgg.com/assets/previews/2016-05-09-rails-app-engine.jpg" /> <link href='//fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic|Open+Sans:300italic,700italic,400,700,300' rel='stylesheet' type='text/css'> <link href="/atom.xml" rel="alternate" type="application/atom+xml" title="Marcgg#Blog"> <link rel="shortcut icon" href="/assets/favicon.png"> <style type="text/css"> /* http://meyerweb.com/eric/tools/css/reset/ v2.0 | 20110126 License: none (public domain) */ html, body, div, span, applet, object, iframe, h1, h2, h3, h4, h5, h6, p, blockquote, pre, a, abbr, acronym, address, big, cite, code, del, dfn, em, img, ins, kbd, q, s, samp, small, strike, strong, sub, sup, tt, var, b, u, i, center, dl, dt, dd, ol, ul, li, fieldset, form, label, legend, table, caption, tbody, tfoot, thead, tr, th, td, article, aside, canvas, details, embed, figure, figcaption, footer, header, hgroup, menu, nav, output, ruby, section, summary, time, mark, audio, video { margin: 0; padding: 0; border: 0; font-size: 100%; font: inherit; vertical-align: baseline; } /* HTML5 display-role reset for older browsers */ article, aside, details, figcaption, figure, footer, header, hgroup, menu, nav, section { display: block; } body { line-height: 1; } ol, ul { list-style: none; } blockquote, q { quotes: none; } blockquote:before, blockquote:after, q:before, q:after { content: ''; content: none; } table { border-collapse: collapse; border-spacing: 0; } .clearfix:after { content: "."; display: block; clear: both; visibility: hidden; line-height: 0; height: 0; } .clearfix { display: inline-block; } html[xmlns] .clearfix { display: block; } * html .clearfix { height: 1%; } @font-face { font-family: 'anonymousregular'; src: url('/assets/fonts/Anonymous-webfont.eot'); src: url('/assets/fonts/Anonymous-webfont.eot?#iefix') format('embedded-opentype'), url('/assets/fonts/Anonymous-webfont.woff') format('woff'), url('/assets/fonts/Anonymous-webfont.ttf') format('truetype'), url('/assets/fonts/Anonymous-webfont.svg#anonymousregular') format('svg'); font-weight: normal; font-style: normal; } body{ font-size: 15px; font-family: 'Droid Serif', serif; color: #353535; line-height: 25px; } #gradient{ height: 5px; background: rgba(237,82,82,0.64); background: -moz-linear-gradient(left, rgba(237,82,82,0.64) 0%, rgba(250,21,0,0.65) 20%, rgba(237,82,82,0.66) 52%, rgba(255,21,0,0.66) 80%, rgba(237,82,82,0.67) 100%); background: -webkit-gradient(left top, right top, color-stop(0%, rgba(237,82,82,0.64)), color-stop(20%, rgba(250,21,0,0.65)), color-stop(52%, rgba(237,82,82,0.66)), color-stop(80%, rgba(255,21,0,0.66)), color-stop(100%, rgba(237,82,82,0.67))); background: -webkit-linear-gradient(left, rgba(237,82,82,0.64) 0%, rgba(250,21,0,0.65) 20%, rgba(237,82,82,0.66) 52%, rgba(255,21,0,0.66) 80%, rgba(237,82,82,0.67) 100%); background: -o-linear-gradient(left, rgba(237,82,82,0.64) 0%, rgba(250,21,0,0.65) 20%, rgba(237,82,82,0.66) 52%, rgba(255,21,0,0.66) 80%, rgba(237,82,82,0.67) 100%); background: -ms-linear-gradient(left, rgba(237,82,82,0.64) 0%, rgba(250,21,0,0.65) 20%, rgba(237,82,82,0.66) 52%, rgba(255,21,0,0.66) 80%, rgba(237,82,82,0.67) 100%); background: linear-gradient(to right, rgba(237,82,82,0.64) 0%, rgba(250,21,0,0.65) 20%, rgba(237,82,82,0.66) 52%, rgba(255,21,0,0.66) 80%, rgba(237,82,82,0.67) 100%); filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#ed5252', endColorstr='#ed5252', GradientType=1 ); } /* STRUCTURE */ #container{ background-color: #fafafa; } #content{ width: 760px; margin: auto; margin-top: 40px; padding-bottom: 60px; padding-top: 40px; } /* FOOTER */ footer{ padding: 40px 0px; text-align: center; border-top: 1px solid #e6e6e6; font-size: 0.8em; color: #9a9a9a; background-color: #fafafa; } footer a{ color: #9a9a9a; } /* HEADER */ header{ width: 760px; margin: auto; height: 50px; border-bottom: 1px solid #f1f1f1; position: relative; } #more-nav{ font-size: 0.75em; display: inline-block; position: absolute; top: 0px; font-family: "anonymousregular"; padding-top: 5px; right: 0px; } #more-nav a{ padding: 0px 2px; text-decoration: none; color: #353535; } #more-nav a:hover{ transition: 0s; background-image: linear-gradient(to bottom, #fff 30%, rgba(200, 200, 200, 0.4) 50%); background-repeat: repeat-x; background-size: 2px 2px; background-position: 0px 100%; } #more-nav .selected{ color: #ed5252; font-weight: bold; } #logo{ font-size: 1.2em; font-family: "anonymousregular"; margin-top: 20px; } #logo *{ text-decoration: none; } #logo1{ color: #999; } #logo2{ font-size: 0.8em; color: #ed5252; } #logo3{ color: #353535; } #logo a:hover{ color: #ed5252; transition-duration: 1s; } /* TEXT STRUCTURE */ h1, h2, h3, h4, h5{ font-family: 'Open Sans', sans-serif; color: #1c1c1c; } a:hover{ color: #ed5252; transition-duration:0.2s; } p a, ul a, .review a{ color: #763232; text-decoration: none; background-image: linear-gradient(to bottom, #fff 30%, rgba(200, 200, 200, 0.4) 50%); background-repeat: repeat-x; background-size: 2px 2px; background-position: 0px 100%; } .homepage a{ color: #353535; } p{ text-align: justify; margin-bottom: 20px; } .excerpt p{ margin-bottom: 0px; } .footnote, .sidenote{ margin: 40px 0px; color: #858585; text-align: right; font-size: 0.9em; font-style: italic; } .image_notes{ text-align: center; color: #858585; font-size: 0.9em; margin: -5px 0px 15px 0px; } h1{ font-size: 2.45em; text-align: center; margin: 70px 0px 20px 0px; line-height : 1.5em; } h1 em{ color: #888; font-weight: normal; font-size: 0.8em; } h2{ font-size: 1.75em; margin: 50px 0px 50px 0px; line-height: 1.75em; } h2::before{ content: "#"; color: #ed5252; font-family: "anonymousregular"; display: inline-block; float: left; padding: 3px 10px 0px 0px; font-size: 0.7em; } h3{ font-size: 1.35em; margin-bottom: 20px; } h4{ font-size: 1.2em; margin-bottom: 20px; font-style: italic; } h5{ font-size: 1.3em; margin-bottom: 20px; } h5 *{ color: #353535; } em{ font-style: italic; } strong{ font-weight: bold; } blockquote{ border-left: 3px solid #ddd; color: #888; margin: 0px 0px 20px 40px; font-style: italic; } blockquote p{ margin: 5px 20px !important; } ul{ padding-left: 40px; line-height: 25px; list-style: square; margin-bottom: 20px; } li{ display: list-item; } ol{ padding-left: 40px; line-height: 25px; margin-bottom: 20px; list-style-type: decimal; } /* TAGS */ .home-tag { font-size: 10px; display: inline-block; border: 1px solid #dedede; padding: 2px 2px 1px 2px; border-radius: 2px; line-height: 10px; margin-left: 1px; } .tag-date{ color: #aaa; } .tag-management { border-color: #929aff; color: #929aff; } .tag-programming { border-color: #ff9292; color: #ff9292; } .tag-coaching { border-color: #4ec698; color: #4ec698; } .tag-projectmanagement { border-color: #929aff; color: #929aff; } /* BLOG INDEX */ #all-posts{ margin: 0px auto 10px auto; width: 760px; } .single-post{ border-top: 1px solid #f1f1f1; padding: 40px 0px; float: clear; } .single-post:first-child{ border-top: none !important; } .single-post .date{ color: #cdcdcd; margin-top: 10px; float: right; } .single-post .author{ color: #cdcdcd; float: right; font-size: 0.7em; } .single-post .title{ font-family: 'Open Sans', sans-serif; font-size: 1.6em; margin-bottom: 20px; line-height: 1.6em; position: relative; } .single-post .title a{ color: #353535; text-decoration: none; } .single-post .title a::before{ content: "→"; opacity: 0; font-family: "anonymousregular"; font-size: 0.7em; position: absolute; left: -30px; transition: all .4s ease-in-out; } .single-post .title a:hover::before{ opacity: 1; transition: all .4s ease-in-out; color: #ed5252; } .single-post .title em{ display: none; } .data_table{ border: 1px solid #efefef; font-family: "anonymousregular"; font-size: 12px; margin: auto auto 20px auto; } .data_table tr{ border: 1px solid #efefef; } .data_table th{ background-color: #efefef; } .data_table th, .data_table td{ padding: 2px 5px; } .post table { margin: 0px auto 20px auto; border: 1px solid #dedede; } .post td { padding: 5px 10px; } /* BOOKS */ .book-cover-entry{ width: 120px; margin-right: 20px; float: left; font-size: 12px; text-decoration: none !important; } .buy-book{ text-decoration: underline; } .book-cover-entry img{ width: 120px; } .book-cover-entry { background-image: none; } .book-rating .icon { display: inline-block; padding-right: 5px; } .book-rating .top .icon{ color: #1CED00; } .book-rating .good .icon{ color: #82ED00; } .book-rating .medium .icon{ color: #EDD100; } .book-rating .low .icon{ color: #EDAE00; } .book-rating .poor .icon{ color: #ED3B00; } #buy-title{ padding: 0px 0px 25px 0px; } #buy-title span{ font-size: 0.8em !important; color: #cdcdcd; } #buy-popin{ padding: 30px 15px; } .store{ display: block; padding: 15px 5px; text-decoration: none; } .store:hover{ color: #ed5252; } #upcoming-books{ padding-top: 20px; } #upcoming-books img{ height: 90px; margin-right: 10px; border: 1px solid #fff; } #upcoming-books a{ text-decoration: none; } #upcoming-books img:hover{ border: 1px solid #ed5252; } /* BLOG SHOW */ .post{ } p code, li code{ background-color: #efefef; font-family: "Lucida Console", "Courier New", Courier, monospace; padding: 1px 2px; font-size: 13px; } .post img{ border: 1px solid #e6e6e6; padding: 5px; margin: 0px 0px 20px 20px; } .published span{ border-top: 1px solid #e6e6e6; display: inline-block; color: #858585; padding-top: 5px; font-family: 'Open Sans', sans-serif; font-size: 0.9em; padding: 5px 20px 0px 20px; } .published{ text-align: center; margin-bottom: 65px; } #more{ border-top: 1px solid #e6e6e6; margin-top: 40px; padding: 40px 0px; } #more-articles{ margin-bottom: 40px; } .image-wrapper em{ display: block; font-size: 0.8em; margin: -20px 0px 20px 0px; color: #aaa; } .image-wrapper em a{ color: #aaa; } .twitter-tweet{ margin: auto; max-width: 420px !important; } #book-review{ border: 1px dashed #dedede; padding: 20px; margin-bottom: 20px; opacity: 0.7; } #book-review a{ color: #763232; } /* Music */ .js_play_sound, .js_stop_sound{ display: inline-block; padding: 4px 10px 2px 10px; border: 1px solid #efefef; background-color: #efefef; margin-right: 10px; text-decoration: none; border-radius: 3px; font-family: 'anonymousregular'; font-size: 12px; } .js_play_sound:hover, .js_stop_sound:hover{ background-color: #dedede; } /* Comments */ #comments{ padding-top: 20px; } #show-disqus-arrow{ color: #ed5252; } /* CLEARFIX */ .cf:before, .cf:after { content: " "; /* 1 */ display: table; /* 2 */ } .cf:after { clear: both; } /************************ MOBILE LAYOUT *********************/ @media all and (max-width: 800px) { .home-tag { display: none; } .author{ float: none !important; display: inline; } header{ width: 92%; padding: 4%; height: 75px; position: relative; text-align: center; background-color: #fafafa; } #more-nav{ left: 0px; top: 50px; } #logo{ margin-top: 10px; } #content, #all-posts{ width: 92%; padding: 4%; } .image-wrapper{ width: 100%; } .image-wrapper img, .post div img, .post p img{ max-width: 100% !important; padding: 15px 0px !important; margin: 20px 0px 20px 0px !important; border-right: 0px; border-left: 0px; } .single-post .title{ font-size: 1.4em; } .date{ display: none; } h1{ font-size: 1.7em; width: 94%; padding: 3%; } h2{ font-size: 1.50em; margin: 30px 0px 30px 0px; line-height: 1.75em; } h3{ font-size: 1.30em; } blockquote{ margin: 0px 0px 20px 0px !important; } pre{ margin-left: 0px !important; margin-right: 0px !important; width: 90%; overflow-x: scroll; } code{ width: 100%; font-size: 13px !important; } footer div{ display: inline; } /* Hire me responsive */ #hire ul{ padding-left: 15px; } #talking-img{ width: 100%; } #talking-img img{ width: 100% !important; } #reviews{ border-top: 1px dashed #e6e6e6; padding: 15px 0px 15px 0px; } #references_logo{ padding: 0px 0px 15px 0px; } .review{ width: 100%; margin: 0px 0px 15px 0px; padding: 0px; border-bottom: 1px dashed #e6e6e6; } #references_logo img, #references_logo .minor{ width: 22%; float: left; margin: 15px 2% 15px 0px; } .data_table th, .data_table td{ font-size: 8px; padding: 0px; border: 1px solid #efefef; } } /* CONVERSATION */ #post-conversation blockquote{ color: rgb(84, 84, 84); font-style: normal; margin: 20px 40px; } #post-conversation blockquote p{ margin: 10px 20px !important; } #post-conversation blockquote .dpm{ color: #3B9E2E !important; font-family: 'Open Sans', sans-serif; font-size: 13px; } #post-conversation blockquote .ddev{ color: #AD34CF !important; font-family: 'Open Sans', sans-serif; font-size: 13px; } #post-conversation blockquote .dcto{ color: #9E2E2E !important; font-family: 'Open Sans', sans-serif; font-size: 13px; } </style> </head> <body> <div id="gradient"></div> <header> <div id="logo"> <a id='logo1' href="/">marcgg</a> <span id='logo2'>#</span> <a id='logo3' href="/blog/"> blog </a> </div> <div id="more-nav"> &rarr; <a href="/blog/" class="selected">blog</a> &rarr; <a href="/books/" class="">books</a> &rarr; <a href="/hire/" class="">hire me</a> </div> </header> <h1> <span> First Impressions: Rails 5 on Google App Engine </span> </h1> <div class="published"> <span>09 May 2016</span> </div> <div id="container"> <div id="content"> <div class="post" id="post-"> <p>The past week had two great news: <a href="https://cloudplatform.googleblog.com/2016/05/Ruby-on-Google-App-Engine-goes-betaruntime.html">Ruby on Google App Engine went beta</a> and <a href="https://rubygems.org/gems/rails/versions/5.0.0.rc1">Rails 5.0.0.rc1 was released</a>. I decided it was a good opportunity to try both!</p> <p>This article relates my experience trying to run a very basic Rails 5.0.0.rc1 application on the Google App Engine. As a reference, I’m fairly experienced with Rails but I never really used the Google App Engine before. It’s also worth mentionning that I’m used to platforms like Heroku, but I used Amazon solutions as well.</p> <h2 id="basic-setup">Basic Setup</h2> <h3 id="account-creation">Account Creation</h3> <p>I don’t want to spend any money for this test, so I digged into <a href="https://cloud.google.com/appengine/docs/quotas">Google’s pricing structure</a> and they do announce a free tier with limited instance hours. Creating a “free trial” account does require a credit card, which worries me a bit, but they do say “Don’t worry, you will not be billed for the free trial”, so hopefuly I’ll be ok.</p> <h3 id="setting-up-the-instance">Setting Up The Instance</h3> <p>Right away they send me into a tutorial with some <a href="http://cl.ly/1H2J2y2J461W">UI issues</a> but quite helpful nonetheless. First I need to create a VM instance and to do it I get to use a surprisingly simple UI. I also appreciate that I don’t need to dig into <a href="https://en.wikipedia.org/wiki/Identity_management">IAM</a> right now which is great, I can just keep moving forward and don’t worry about it just yet.</p> <p>There is a lot of choices to be made, from the instance type, to the boot disk and boot disk type. It’s pretty great!</p> <div class="image-wrapper" style="text-align: center"><img src="/assets/blog/app_engine_instances.jpg" alt="" style="padding: 20px; width: 310px;" /><img src="/assets/blog/app_engine_disk.jpg" alt="" style="padding: 20px; width: 310px;" /></div> <p>I decide to go on a micro instance running a stable version of Ubuntu on a SSD.</p> <p>At this point in the tutorial, they’re pushing me toward creating a separate frontend instance. That’s not really what I had in mind since I’m more a <a href="http://martinfowler.com/bliki/MonolithFirst.html">Start With A Monolith</a> / <a href="https://m.signalvnoise.com/the-majestic-monolith-29166d022228#.513x0buqb">The Majestic Monolith</a> kind of person. I therefore leave the guided tutorial and now I’m on my own.</p> <p>Browsing around the different admin pages makes me think that the UI goes from very clear to kind of bloated. The dashboard in particular is really intense at first, but it’s also customizable so I’m not really complaining.</p> <div class="image-wrapper" style="text-align: center"><img src="/assets/blog/app_engine_dashboard.jpg" alt="" style="padding: 20px; width: 600px;" /></div> <h3 id="building-the-app">Building The App</h3> <p>Now that I have an instance seemingly running (some graphs are moving - that’s usually a good sign), I need to push some code to it! I quickly create a basic Rails 5 app on the current <a href="https://twitter.com/schneems/status/728588592470052864">release candidate</a>:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ rails _5.0.0.rc1_ new demo-rails-5
</code></pre></div></div> <p>I then add a simple controller with an action and that’s it. No need to get fancy at this point.</p> <h2 id="deploying">Deploying</h2> <h3 id="the-google-cloud-sdk">The Google Cloud SDK</h3> <p>To do anything from there I need to install the SDK. The <a href="https://cloud.google.com/sdk/docs/">documentation</a> is clear, but the installation is not as smooth as other projects like the <a href="https://toolbelt.heroku.com/">Heroku Toolbelt</a>. It does seem more powerful, so it feels more like they traded off usability for customizability, which can make sense since Google’s offer is supposed to do a lot.</p> <p>Once all the configuration is over, including linking my Google account to my SDK, I can finally run the deploy command:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ gcloud preview app deploy
</code></pre></div></div> <p>I like this part very much because they really take you by the hand and guide you through the things you need to be doing before releasing:</p> <div class="image-wrapper" style="text-align: center"><img src="/assets/blog/app_engine_sdk.jpg" alt="" style="padding: 20px; width: 600px;" /></div> <p>It goes as far as creating an <code class="language-plaintext highlighter-rouge">app.yaml</code> configuration file for you, with smart defaults based on your environment:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>api_version: 1
entrypoint: bundle exec rackup -p $PORT
runtime: ruby
vm: true
</code></pre></div></div> <p>Once this is done, the deploy really happens… and it’s very slow. To be fair they do warn that the first deploy is supposed to be slower, so we’ll see if it’s better later on.</p> <p>After a bit I get a success message. My app is on Google App Engine, and I even have a nice custom URL: <a href="https://rails-5-test.appspot.com/">https://rails-5-test.appspot.com/</a> !</p> <p>Great! Let’s check it out!</p> <div class="image-wrapper" style="text-align: center"><img src="/assets/blog/app_engine_sdk.jpg" alt="" style="padding: 20px; width: 600px;" /></div> <p>“An unhandled lowlevel error occurred. The application logs may have details.” <a href="https://s3.amazonaws.com/f.cl.ly/items/2a3y0e090f2P1Y1s1a31/Youre_tearing_me_apart_lisa-36704.gif?v=7a6cf7f4">…</a></p> <h3 id="debugging-production">Debugging Production</h3> <h4 id="reading-logs">Reading Logs</h4> <p>I have to find how to read my logs to figure out what’s going on, so I start looking.</p> <p>I first run into the <code class="language-plaintext highlighter-rouge">gets-log</code> command, but it feels a bit complicated since I’m not sure exactly what logs are going to help me debug. I then find the <code class="language-plaintext highlighter-rouge">gcloud beta logging logs</code> command that is supposed to list all the logs available, which is pretty great. To run it I have to install gcloud Beta Commands, so I install this as well. The command works, but I’m still a bit confused by what I’m supposed to do here and how I could find a way to stream my server’s output to my console.</p> <p>After a few minutes running in circles, I take a step back and find another ressource that was way more helpful: <a href="https://cloud.google.com/appengine/articles/logging">Using Cloud logging in App Engine apps</a>. Apparently I can use a service called the <a href="https://cloud.google.com/appengine/articles/logging#using_the_logs_viewer">Logs Viewer</a> to access my logs directly from the UI, so I decide to try it out.</p> <p>My first impression is that there are a LOT of things going on there. I thought that I only had one instance, but apparently there’s all kind of processes running on my account like a firewall or an autoscaler:</p> <div class="image-wrapper" style="text-align: center"><img src="/assets/blog/app_engine_confused.jpg" alt="" style="padding: 20px; width: 600px;" /></div> <p>After fiddling with the various filters I end up finding the “just show me everything” setup:</p> <div class="image-wrapper" style="text-align: center"><img src="/assets/blog/app_engine_logs.jpg" alt="" style="padding: 20px; width: 600px;" /></div> <p>At this point I see hits, so it’s a good start.</p> <div class="image-wrapper" style="text-align: center"><img src="/assets/blog/app_engine_hits.jpg" alt="" style="padding: 20px; width: 600px;" /></div> <p>As it turns out I have a configuration issue: <code class="language-plaintext highlighter-rouge">#&lt;RuntimeError: Missing 'secret_key_base' for 'production' environment, set this value in 'config/secrets.yml'&gt;</code>.</p> <h4 id="environment-variables">Environment Variables</h4> <p>Right now the problematic section of our <code class="language-plaintext highlighter-rouge">secrets.yml</code> file looks like this:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>production:
  secret_key_base: &lt;%= ENV["SECRET_KEY_BASE"] %&gt;
</code></pre></div></div> <p>For obvious security reasons I don’t want to just change the <code class="language-plaintext highlighter-rouge">secrets.yml</code> to add the secret key and then commit it, so I have to figure out how to set an environment variable.</p> <p>Once again the <a href="https://cloud.google.com/appengine/docs/flexible/ruby/runtime#environment_variables">documentation</a> is well done and easy to find. As it turns out <a href="https://cloud.google.com/appengine/docs/flexible/ruby/configuring-your-app-with-app-yaml#Ruby_app_yaml_Defining_environment_variables">I have to define them</a> in the <code class="language-plaintext highlighter-rouge">app.yaml</code> file… that’s fine but I honestly would have prefered a solution that didn’t require me to mix code and production variables, but that’ll do for now.</p> <h4 id="releasing-again">Releasing (again)</h4> <p>I update the <code class="language-plaintext highlighter-rouge">app.yaml</code> file and do another release.</p> <p>This time it does feel faster than before, and the logs seem to indicate that they’re leveraging some kind of cache which is great. However it still gets stuck on “Updating service default…” for what seemed like an excessive amount of time.</p> <div class="image-wrapper" style="text-align: center"><img src="/assets/blog/app_engine_cache.jpg" alt="" style="padding: 20px; width: 300px;" /></div> <p>I go to the URL once again and … it works this time!!</p> <div class="image-wrapper" style="text-align: center"><img src="/assets/blog/app_engine_success.jpg" alt="" style="padding: 20px; width: 500px;" /></div> <h2 id="comparing-heroku-and-google-app-engine">Comparing Heroku and Google App Engine</h2> <p>I’m really not going to get into running a serious performance review, but for the fun of it I wanted to see how my micro instance would compare with Heroku’s free tier on this very basic Rails 5 application.</p> <p>To do this I pushed the same app to <a href="https://rails-5-test-mgg.herokuapp.com/">https://rails-5-test-mgg.herokuapp.com/</a> and just hit the refresh button a bunch of times and looked at results, because who needs proper methodology?</p> <p>Google App Engine (micro, 1CPU, 0.6GB RAM) seems to respond this way (give or take 5ms):</p> <div class="image-wrapper" style="text-align: center; "><img src="/assets/blog/app_engine_perf.jpg" alt="" style="padding: 5px; width: 100%;margin-left: 0px !important;" /></div> <p>On the other side Heroku (free tier, 1CPU, 512MB RAM) responded this way (give or take 5ms):</p> <div class="image-wrapper" style="text-align: center; "><img src="/assets/blog/app_engine_heroku.jpg" alt="" style="padding: 5px; width: 100%;margin-left: 0px !important;" /></div> <p>Overall Heroku seems just a bit faster than App Engine. There’s an overhead in term of network for Heroku because Google made it really easy to pick a region, so my app is running in Europe, right next to me, whereas the Heroku app has to cross the Atlantic.</p> <h2 id="conclusion">Conclusion</h2> <p>Overall I was very pleasantly suprised by what Google had to offer and how quick it was to get something running even with absolutely no experience in the platform. Documentation is very well written and, in my opinion, it felt less disorienting than setting up an <a href="https://aws.amazon.com/ec2/">EC2</a> instance for the first time.</p> <p>The integration with Ruby and Rails is well done, deploying is simple and besides the <code class="language-plaintext highlighter-rouge">secrets.yml</code> gotcha, it went smoothly. Sinatra integration is supposed to be as good but I haven’t tried it yet.</p> <p>I might pick this over <a href="https://aws.amazon.com/">AWS</a> for a pet project at some point to try it out some more.</p> <div id="more"> <div id="more-articles"> <p>Since you scrolled this far, you might be interested in some other things I wrote:</p> <ul> <li><a href="/blog/2020/04/11/add-text-image-rmagick-imagemagick/">Add Text Over an Image with Ruby</a></li> <li><a href="/blog/2020/04/08/rails-update-bang/">Misuse of update/update! in Ruby on Rails</a></li> <li><a href="/blog/2018/10/22/regression-testing-for-data-ruby/">Regression Testing For Data</a></li> <li><a href="/blog/2018/05/15/expressing-intent-comments-ruby/">Expressing Intent Without Comments In Ruby</a></li> <li><a href="/blog/2017/01/23/ruby-to-s-to-str/">The Difference Between to&#95;s & to&#95;str In Ruby</a></li> <li><a href="/blog/2016/08/22/csrf-rails/">Understanding Rails' Forgery Protection Strategies</a></li> <li><a href="/blog/2016/02/15/rspec-on-multiple-rails-projects/">Automatically Run RSpec on Multiple Projects</a></li> <li><a href="/books/">Startup & Tech Book Reviews</a> </ul> </div> <a href="https://twitter.com/marcgg" class="twitter-follow-button" data-show-count="false" data-size="large">Follow @marcgg</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script> <a href="https://twitter.com/share" class="twitter-share-button" data-via="marcgg" data-size="large">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script> </div> <div id="comments"> <style id="disqus_hide"> #disqus_thread{ display: none; } </style> <p> <span id="show-disqus-arrow">&rarr; </span> <a href="#" id="show-disqus">Read the comments or contribute with your own</a> </p> <div id="disqus_thread"></div> </div> <script type="text/javascript"> var disqus_shortname = 'marcgg'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); </script> </div> </div> </div> <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script> <script src="/assets/js/comments.js"></script> <link rel="preload" href="/assets/css/code.css" as="style" onload="this.rel='stylesheet'"> <script> /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */ !function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this); /*! loadCSS rel=preload polyfill. [c]2017 Filament Group, Inc. MIT License */ !function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this); </script> <footer> <div>Website powered by <a href="https://github.com/jekyll/jekyll">Jekyll</a>, hosted on <a href="https://github.com/marcgg/marcgg.github.com">Github</a> and put together by <a href="http://twitter.com/marcgg">@marcgg</a>.</div> <div>All of the <a href="/blog">blog's articles</a> are under <a href="http://creativecommons.org/licenses/by-sa/3.0/">Creative commons</a> license unless stated otherwise. Everything else is &copy;.</div> </footer> <script type="text/javascript"> var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-31071519-1']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })(); </script> </body> </html>


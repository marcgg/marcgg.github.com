<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <title> Building A Multiplayer 8 Bits Sequencer </title> <meta name="description" content="During a hackathon I build a way to play chiptune music with people online. It uses websockets, the Web Audio API and the latest Rails 5 features."> <meta name="author" content="Marc G Gauthier"> <meta content='user-scalable=no, width=device-width, initial-scale=1.0' name='viewport'> <meta name="google-site-verification" content="x2EpQdOMz-k9fP8hak9I3COaXhnQ4jNLp2GU4GYQ8jM" /> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:site" content="@marcgg"> <meta name="twitter:creator" content="@marcgg"> <meta name="twitter:title" content="Building A Multiplayer 8 Bits Sequencer"> <meta name="twitter:description" content="During a hackathon I build a way to play chiptune music with people online. It uses websockets, the Web Audio API and the latest Rails 5 features."> <meta name="twitter:image" content="https://marcgg.com/assets/previews/2016-11-21-chiptune-sequencer-multiplayer.jpg" /> <meta name="image" property="og:image" content="https://marcgg.com/assets/previews/2016-11-21-chiptune-sequencer-multiplayer.jpg" /> <link href='//fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic|Open+Sans:300italic,700italic,400,700,300' rel='stylesheet' type='text/css'> <link href="/atom.xml" rel="alternate" type="application/atom+xml" title="Marcgg#Blog"> <link rel="shortcut icon" href="/assets/favicon.png"> <style type="text/css"> /* http://meyerweb.com/eric/tools/css/reset/ v2.0 | 20110126 License: none (public domain) */ html, body, div, span, applet, object, iframe, h1, h2, h3, h4, h5, h6, p, blockquote, pre, a, abbr, acronym, address, big, cite, code, del, dfn, em, img, ins, kbd, q, s, samp, small, strike, strong, sub, sup, tt, var, b, u, i, center, dl, dt, dd, ol, ul, li, fieldset, form, label, legend, table, caption, tbody, tfoot, thead, tr, th, td, article, aside, canvas, details, embed, figure, figcaption, footer, header, hgroup, menu, nav, output, ruby, section, summary, time, mark, audio, video { margin: 0; padding: 0; border: 0; font-size: 100%; font: inherit; vertical-align: baseline; } /* HTML5 display-role reset for older browsers */ article, aside, details, figcaption, figure, footer, header, hgroup, menu, nav, section { display: block; } body { line-height: 1; } ol, ul { list-style: none; } blockquote, q { quotes: none; } blockquote:before, blockquote:after, q:before, q:after { content: ''; content: none; } table { border-collapse: collapse; border-spacing: 0; } .clearfix:after { content: "."; display: block; clear: both; visibility: hidden; line-height: 0; height: 0; } .clearfix { display: inline-block; } html[xmlns] .clearfix { display: block; } * html .clearfix { height: 1%; } @font-face { font-family: 'anonymousregular'; src: url('/assets/fonts/Anonymous-webfont.eot'); src: url('/assets/fonts/Anonymous-webfont.eot?#iefix') format('embedded-opentype'), url('/assets/fonts/Anonymous-webfont.woff') format('woff'), url('/assets/fonts/Anonymous-webfont.ttf') format('truetype'), url('/assets/fonts/Anonymous-webfont.svg#anonymousregular') format('svg'); font-weight: normal; font-style: normal; } body{ font-size: 15px; font-family: 'Droid Serif', serif; color: #353535; line-height: 25px; } #gradient{ height: 5px; background: rgba(237,82,82,0.64); background: -moz-linear-gradient(left, rgba(237,82,82,0.64) 0%, rgba(250,21,0,0.65) 20%, rgba(237,82,82,0.66) 52%, rgba(255,21,0,0.66) 80%, rgba(237,82,82,0.67) 100%); background: -webkit-gradient(left top, right top, color-stop(0%, rgba(237,82,82,0.64)), color-stop(20%, rgba(250,21,0,0.65)), color-stop(52%, rgba(237,82,82,0.66)), color-stop(80%, rgba(255,21,0,0.66)), color-stop(100%, rgba(237,82,82,0.67))); background: -webkit-linear-gradient(left, rgba(237,82,82,0.64) 0%, rgba(250,21,0,0.65) 20%, rgba(237,82,82,0.66) 52%, rgba(255,21,0,0.66) 80%, rgba(237,82,82,0.67) 100%); background: -o-linear-gradient(left, rgba(237,82,82,0.64) 0%, rgba(250,21,0,0.65) 20%, rgba(237,82,82,0.66) 52%, rgba(255,21,0,0.66) 80%, rgba(237,82,82,0.67) 100%); background: -ms-linear-gradient(left, rgba(237,82,82,0.64) 0%, rgba(250,21,0,0.65) 20%, rgba(237,82,82,0.66) 52%, rgba(255,21,0,0.66) 80%, rgba(237,82,82,0.67) 100%); background: linear-gradient(to right, rgba(237,82,82,0.64) 0%, rgba(250,21,0,0.65) 20%, rgba(237,82,82,0.66) 52%, rgba(255,21,0,0.66) 80%, rgba(237,82,82,0.67) 100%); filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#ed5252', endColorstr='#ed5252', GradientType=1 ); } /* STRUCTURE */ #container{ background-color: #fafafa; } #content{ width: 760px; margin: auto; margin-top: 40px; padding-bottom: 60px; padding-top: 40px; } /* FOOTER */ footer{ padding: 40px 0px; text-align: center; border-top: 1px solid #e6e6e6; font-size: 0.8em; color: #9a9a9a; background-color: #fafafa; } footer a{ color: #9a9a9a; } /* HEADER */ header{ width: 760px; margin: auto; height: 50px; border-bottom: 1px solid #f1f1f1; position: relative; } #more-nav{ font-size: 0.75em; display: inline-block; position: absolute; top: 0px; font-family: "anonymousregular"; padding-top: 5px; right: 0px; } #more-nav a{ padding: 0px 2px; text-decoration: none; color: #353535; } #more-nav a:hover{ transition: 0s; background-image: linear-gradient(to bottom, #fff 30%, rgba(200, 200, 200, 0.4) 50%); background-repeat: repeat-x; background-size: 2px 2px; background-position: 0px 100%; } #more-nav .selected{ color: #ed5252; font-weight: bold; } #logo{ font-size: 1.2em; font-family: "anonymousregular"; margin-top: 20px; } #logo *{ text-decoration: none; } #logo1{ color: #999; } #logo2{ font-size: 0.8em; color: #ed5252; } #logo3{ color: #353535; } #logo a:hover{ color: #ed5252; transition-duration: 1s; } /* TEXT STRUCTURE */ h1, h2, h3, h4, h5{ font-family: 'Open Sans', sans-serif; color: #1c1c1c; } a:hover{ color: #ed5252; transition-duration:0.2s; } p a, ul a, .review a{ color: #763232; text-decoration: none; background-image: linear-gradient(to bottom, #fff 30%, rgba(200, 200, 200, 0.4) 50%); background-repeat: repeat-x; background-size: 2px 2px; background-position: 0px 100%; } .homepage a{ color: #353535; } p{ text-align: justify; margin-bottom: 20px; } .excerpt p{ margin-bottom: 0px; } .footnote, .sidenote{ margin: 40px 0px; color: #858585; text-align: right; font-size: 0.9em; font-style: italic; } .image_notes{ text-align: center; color: #858585; font-size: 0.9em; margin: -5px 0px 15px 0px; } h1{ font-size: 2.45em; text-align: center; margin: 70px 0px 20px 0px; line-height : 1.5em; } h1 em{ color: #888; font-weight: normal; font-size: 0.8em; } h2{ font-size: 1.75em; margin: 50px 0px 50px 0px; line-height: 1.75em; } h2::before{ content: "#"; color: #ed5252; font-family: "anonymousregular"; display: inline-block; float: left; padding: 3px 10px 0px 0px; font-size: 0.7em; } h3{ font-size: 1.35em; margin-bottom: 20px; } h4{ font-size: 1.2em; margin-bottom: 20px; font-style: italic; } h5{ font-size: 1.3em; margin-bottom: 20px; } h5 *{ color: #353535; } em{ font-style: italic; } strong{ font-weight: bold; } blockquote{ border-left: 3px solid #ddd; color: #888; margin: 0px 0px 20px 40px; font-style: italic; } blockquote p{ margin: 5px 20px !important; } ul{ padding-left: 40px; line-height: 25px; list-style: square; margin-bottom: 20px; } li{ display: list-item; } ol{ padding-left: 40px; line-height: 25px; margin-bottom: 20px; list-style-type: decimal; } /* TAGS */ .home-tag { font-size: 10px; display: inline-block; border: 1px solid #dedede; padding: 2px 2px 1px 2px; border-radius: 2px; line-height: 10px; margin-left: 1px; } .tag-date{ color: #aaa; } .tag-management { border-color: #929aff; color: #929aff; } .tag-programming { border-color: #ff9292; color: #ff9292; } .tag-coaching { border-color: #4ec698; color: #4ec698; } .tag-projectmanagement { border-color: #929aff; color: #929aff; } /* BLOG INDEX */ #all-posts{ margin: 0px auto 10px auto; width: 760px; } .single-post{ border-top: 1px solid #f1f1f1; padding: 40px 0px; float: clear; } .single-post:first-child{ border-top: none !important; } .single-post .date{ color: #cdcdcd; margin-top: 10px; float: right; } .single-post .author{ color: #cdcdcd; float: right; font-size: 0.7em; } .single-post .title{ font-family: 'Open Sans', sans-serif; font-size: 1.6em; margin-bottom: 20px; line-height: 1.6em; position: relative; } .single-post .title a{ color: #353535; text-decoration: none; } .single-post .title a::before{ content: "→"; opacity: 0; font-family: "anonymousregular"; font-size: 0.7em; position: absolute; left: -30px; transition: all .4s ease-in-out; } .single-post .title a:hover::before{ opacity: 1; transition: all .4s ease-in-out; color: #ed5252; } .single-post .title em{ display: none; } .data_table{ border: 1px solid #efefef; font-family: "anonymousregular"; font-size: 12px; margin: auto auto 20px auto; } .data_table tr{ border: 1px solid #efefef; } .data_table th{ background-color: #efefef; } .data_table th, .data_table td{ padding: 2px 5px; } .post table { margin: 0px auto 20px auto; border: 1px solid #dedede; } .post td { padding: 5px 10px; } /* BOOKS */ .book-cover-entry{ width: 120px; margin-right: 20px; float: left; font-size: 12px; text-decoration: none !important; } .buy-book{ text-decoration: underline; } .book-cover-entry img{ width: 120px; } .book-cover-entry { background-image: none; } .book-rating .icon { display: inline-block; padding-right: 5px; } .book-rating .top .icon{ color: #1CED00; } .book-rating .good .icon{ color: #82ED00; } .book-rating .medium .icon{ color: #EDD100; } .book-rating .low .icon{ color: #EDAE00; } .book-rating .poor .icon{ color: #ED3B00; } #buy-title{ padding: 0px 0px 25px 0px; } #buy-title span{ font-size: 0.8em !important; color: #cdcdcd; } #buy-popin{ padding: 30px 15px; } .store{ display: block; padding: 15px 5px; text-decoration: none; } .store:hover{ color: #ed5252; } #upcoming-books{ padding-top: 20px; } #upcoming-books img{ height: 90px; margin-right: 10px; border: 1px solid #fff; } #upcoming-books a{ text-decoration: none; } #upcoming-books img:hover{ border: 1px solid #ed5252; } /* BLOG SHOW */ .post{ } p code, li code{ background-color: #efefef; font-family: "Lucida Console", "Courier New", Courier, monospace; padding: 1px 2px; font-size: 13px; } .post img{ border: 1px solid #e6e6e6; padding: 5px; margin: 0px 0px 20px 20px; } .published span{ border-top: 1px solid #e6e6e6; display: inline-block; color: #858585; padding-top: 5px; font-family: 'Open Sans', sans-serif; font-size: 0.9em; padding: 5px 20px 0px 20px; } .published{ text-align: center; margin-bottom: 65px; } #more{ border-top: 1px solid #e6e6e6; margin-top: 40px; padding: 40px 0px; } #more-articles{ margin-bottom: 40px; } .image-wrapper em{ display: block; font-size: 0.8em; margin: -20px 0px 20px 0px; color: #aaa; } .image-wrapper em a{ color: #aaa; } .twitter-tweet{ margin: auto; max-width: 420px !important; } #intro_blurb{ border: 1px dashed #dedede; padding: 20px; margin: 20px 0px; opacity: 0.7; } #intro_blurb a{ color: #763232; } /* Music */ .js_play_sound, .js_stop_sound{ display: inline-block; padding: 4px 10px 2px 10px; border: 1px solid #efefef; background-color: #efefef; margin-right: 10px; text-decoration: none; border-radius: 3px; font-family: 'anonymousregular'; font-size: 12px; } .js_play_sound:hover, .js_stop_sound:hover{ background-color: #dedede; } /* Comments */ #comments{ padding-top: 20px; } #show-disqus-arrow{ color: #ed5252; } /* CLEARFIX */ .cf:before, .cf:after { content: " "; /* 1 */ display: table; /* 2 */ } .cf:after { clear: both; } /************************ MOBILE LAYOUT *********************/ @media all and (max-width: 800px) { .home-tag { display: none; } .author{ float: none !important; display: inline; } header{ width: 92%; padding: 4%; height: 75px; position: relative; text-align: center; background-color: #fafafa; } #more-nav{ left: 0px; top: 50px; } #logo{ margin-top: 10px; } #content, #all-posts{ width: 92%; padding: 4%; } .image-wrapper{ width: 100%; } .image-wrapper img, .post div img, .post p img{ max-width: 100% !important; padding: 15px 0px !important; margin: 20px 0px 20px 0px !important; border-right: 0px; border-left: 0px; } .single-post .title{ font-size: 1.4em; } .date{ display: none; } h1{ font-size: 1.7em; width: 94%; padding: 3%; } h2{ font-size: 1.50em; margin: 30px 0px 30px 0px; line-height: 1.75em; } h3{ font-size: 1.30em; } blockquote{ margin: 0px 0px 20px 0px !important; } pre{ margin-left: 0px !important; margin-right: 0px !important; width: 90%; overflow-x: scroll; } code{ width: 100%; font-size: 13px !important; } footer div{ display: inline; } /* Hire me responsive */ #hire ul{ padding-left: 15px; } #talking-img{ width: 100%; } #talking-img img{ width: 100% !important; } #reviews{ border-top: 1px dashed #e6e6e6; padding: 15px 0px 15px 0px; } #references_logo{ padding: 0px 0px 15px 0px; } .review{ width: 100%; margin: 0px 0px 15px 0px; padding: 0px; border-bottom: 1px dashed #e6e6e6; } #references_logo img, #references_logo .minor{ width: 22%; float: left; margin: 15px 2% 15px 0px; } .data_table th, .data_table td{ font-size: 8px; padding: 0px; border: 1px solid #efefef; } } /* CONVERSATION */ #post-conversation blockquote{ color: rgb(84, 84, 84); font-style: normal; margin: 20px 40px; } #post-conversation blockquote p{ margin: 10px 20px !important; } #post-conversation blockquote .dpm{ color: #3B9E2E !important; font-family: 'Open Sans', sans-serif; font-size: 13px; } #post-conversation blockquote .ddev{ color: #AD34CF !important; font-family: 'Open Sans', sans-serif; font-size: 13px; } #post-conversation blockquote .dcto{ color: #9E2E2E !important; font-family: 'Open Sans', sans-serif; font-size: 13px; } /* STATUS */ .status { background-color: #fff; padding: 40px; border: 1px solid #dba9a9; border-radius: 5px; margin: 40px 0px; } .status_text_content { font-size: 18px; line-height: 24px; } .status_text_content p { text-align: start !important; } .status_date { } .status_date a { color: #858585; text-decoration: none; } .status_images { margin: 20px auto; text-align: center; } .status_images img { max-width: 85%; max-height: 500px; } .side_note { color: #aaa; margin-bottom: 42px; text-align: center; } .side_note a{ color: #aaa; } </style> </head> <body> <div id="gradient"></div> <header> <div id="logo"> <a id='logo1' href="/">marcgg</a> <span id='logo2'>#</span> <a id='logo3' href="/blog/"> blog </a> </div> <div id="more-nav"> &rarr; <a href="/blog/" class="selected">blog</a> &rarr; <a href="/status/" class="">status</a> &rarr; <a href="/books/" class="">books</a> &rarr; <a href="/hire/" class="">hire me</a> </div> </header> <h1> <span> Building A Multiplayer 8 Bits Sequencer <br /><em>Web Audio API, Websockets, Rails 5, Javascript & ActionCable fun</em> </span> </h1> <div class="published"> <span>21 November 2016</span> </div> <div id="container"> <div id="content"> <div class="post" id="post-"> <p>For this year <a href="https://www.rubyrampage.com/">Ruby Rampage</a> (previously called Rails Rumble) hackathon I really wanted to build something using the new features of Rails 5. A few years ago I tried to build <a href="/blog/2013/01/14/html5-nodejs-websockets-games-learning/">a multiplayer HTML 5 game in two days</a>, but I had to use NodeJS… now was the time to see if <a href="http://edgeguides.rubyonrails.org/action_cable_overview.html">ActionCable</a> was any better! I also was curious about the new improvements of the Web Audio API ever since I’ve read articles about it.</p> <p>I went ahead and after two days of work I managed to get a working site and deployed it on Heroku. You can <a href="https://warm-escarpment-32217.herokuapp.com/">try it out for yourself online</a> or take a look at this quick demo video:</p> <center><iframe width="560" height="315" src="https://www.youtube.com/embed/JZlsbC-7GZY" frameborder="0" allowfullscreen=""></iframe></center> <p><br /></p> <p>It only works on Chrome and runs on a free Heroku server, but it still handles a decent number of concurrent connections.</p> <h2 id="building-the-sequencer">Building The Sequencer</h2> <p>Since it was a hackathon, I had to cut some corners in terms of test coverage and general code quality. However I was always aiming to build a stable enough project, meaning the site should handle gracefully any bug, timeout or server restart.</p> <h3 id="action-cable--websockets">Action Cable &amp; Websockets</h3> <p>Action Cable provides a simple way to deal with real-time features in a Rails application. It uses <a href="http://redis.io/">Redis</a> a lot, so I had to use a free <a href="https://redislabs.com/redis-cloud">Redis Cloud</a> instance. I also set up <a href="http://puma.io/">Puma</a> since a threaded server is really the way to go when dealing with real-time.</p> <p>Overall the experience was nicer than what I used to with NodeJS and in a few hours I had a somewhat working multiplayer snake “game” that looked terrible:</p> <div class="image-wrapper" style="text-align: center"><img src="/assets/blog/chiptune_step1.jpg" alt="" style="padding: 20px; width: 400px;" /></div> <p>After a bit I realized that it was very hard to maintain the list of connected players and update it when they leave, get disconnected or just stop responding. It’s at this point that I started investing more time into getting a stable way of handling players, with a dedicated model and better integration with Redis. One challenge there was to link a request signature to a player, and make sure the link was properly persisted and updated at the right time.</p> <p>I <a href="https://gist.github.com/marcgg/1f376b58ddca8ef45f47ee831dbc3c37">shared some Ruby code here</a> if you’re interested - but keep in mind that it’s “hackathon code”, so don’t go and just use this :)</p> <h3 id="broadcasting">Broadcasting</h3> <p>An error I made in the past when building a simple real-time multiplayer HTML 5 game was passing around too much information. In this situation, any network access can be a real problem as any millisecond lost is felt in the UI.</p> <p>This time I decided to only broadcast the changes and not the whole world, making the site way more responsive but complexifying the <code class="language-plaintext highlighter-rouge">draw</code> method. I also made sure to clean up what was not used anymore, mostly using the very useful <a href="http://www.redis.io/commands/expire">EXPIRE</a> method provided by Redis.</p> <p>Here’s a simple example with the <code class="language-plaintext highlighter-rouge">Note</code> model, representing an active note in the sequencer:</p> <script src="https://gist.github.com/marcgg/47233a6ca0fe8cc126685bc2a635460c.js"></script> <p>And here is the very simplified version of the client side code handling broadcasts:</p> <figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">App</span><span class="p">.</span><span class="nx">room</span> <span class="o">=</span> <span class="nx">App</span><span class="p">.</span><span class="nx">cable</span><span class="p">.</span><span class="nx">subscriptions</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
  <span class="na">channel</span><span class="p">:</span> <span class="dl">"</span><span class="s2">RoomChannel</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">from</span><span class="p">:</span> <span class="dl">"</span><span class="s2">room.js</span><span class="dl">"</span><span class="p">,</span>
<span class="p">},</span> <span class="nx">received</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Routing</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="dl">"</span><span class="s2">note</span><span class="dl">"</span><span class="p">){</span><span class="nx">App</span><span class="p">.</span><span class="nx">music</span><span class="p">.</span><span class="nx">addNote</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">player</span><span class="err">\</span><span class="nx">_id</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">y</span><span class="p">)}</span>
<span class="p">})</span></code></pre></figure> <h3 id="making-music-using-javascript">Making Music Using Javascript</h3> <p>Once I had a somewhat working server connection, I had to get the client to actually produce sounds. The first version was very simple and used a sine wave to produce random bleeps and boops.</p> <div class="image-wrapper" style="text-align: center"><img src="/assets/blog/chiptune_step2.jpg" alt="" style="padding: 20px; width: 400px;" /></div> <p>During the rest of the hackathon I kept on tweaking this until I got the sound and timings I wanted. I talked more about it in this article: <a href="/blog/2016/11/01/javascript-audio/">Generate Sounds Programmatically With Javascript</a>.</p> <p>Overall, getting the different notes to sound good was the hardest part of this project, because there was the double challenge of understanding both the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API">Web Audio API</a> and picking notes that would fit with one another.</p> <p>I ended up with 3 instruments plus a kick and a snare. Each instrument is based on a simple signal (sawtooth, square and triangle) that is modified to give a better sound. They are then given a full <a href="https://en.wikipedia.org/wiki/Octave">octave</a> on complementary <a href="https://youtu.be/TfDmVwz24lE?t=2m12s">scales</a>, meaning that even if people play totally random notes, it won’t be <a href="https://youtu.be/fabeLu4-Ja0?t=23s">dissonant</a>.</p> <figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">highScale</span> <span class="o">=</span> <span class="p">[</span><span class="dl">"</span><span class="s2">D6</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">C6</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">B5</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">A5</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">G5</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">F#5</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">E5</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">D5</span><span class="dl">"</span><span class="p">]</span>
<span class="kd">var</span> <span class="nx">midScale</span> <span class="o">=</span> <span class="p">[</span><span class="dl">"</span><span class="s2">F#4</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">E4</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">D4</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">C4</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">B3</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">A3</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">G3</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">F#3</span><span class="dl">"</span><span class="p">]</span>
<span class="kd">var</span> <span class="nx">lowScale</span> <span class="o">=</span> <span class="p">[</span><span class="dl">"</span><span class="s2">F#3</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">E3</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">D3</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">C3</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">B2</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">A2</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">G2</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">F#2</span><span class="dl">"</span><span class="p">]</span></code></pre></figure> <h3 id="stability">Stability</h3> <p>Running a real-time service on a free Heroku server that restarts randomly is challenging, but doable. I tried different approaches and ended with a simple yet effective way of dealing with this <a href="https://cl.ly/1H0C3m2h123H">as demonstrated in this screen recording</a>.</p> <div class="image-wrapper" style="text-align: center"><img src="/assets/blog/chiptune_reconnect.jpg" alt="" style="padding: 20px; width: 400px;" /></div> <p>Basically I would detect on the client side any sign that the server was poorly responding. If it was the case, the client would then retry and, if it failed again, the browser would simply reload the page after a delay. There was a couple of places in the flow where this could happen, so I had to handle all of them with custom messages to make the app feel responsive and stable. Of course all this is just an approximation for “real stability”, but from a user perspective it gave the impression that everything was running smoothly.</p> <p>Later on <a href="https://twitter.com/marcgg/status/790187628859650048">I tried with more clients connected</a> and more random restarts / dropped connections and it worked fine.</p> <h3 id="designing">Designing</h3> <p>I decided to go for an old school design to match the 8 bits sound the project was producing. It was hard to get something that looked decent since design is really not my strong suit, but the result turned out ok in my opinon:</p> <div class="image-wrapper" style="text-align: center"><img src="/assets/blog/chiptune_home.jpg" alt="" style="padding: 20px; width: 400px;" /></div> <p>I also had fun <a href="https://twitter.com/marcgg/status/790161693204705281">designing a favicon</a> and using <a href="http://www.color-hex.com/color-palette/165">palettes</a> to pick colors that kind of matched together.</p> <h3 id="playing">Playing</h3> <p>In the last half day of the hackathon I was mostly tweaking the sound and design to get it just the way I wanted it. It was also very enjoyable to see people try out the app!</p> <div class="image-wrapper" style="text-align: center"><img src="/assets/blog/chiptune_playing.jpg" alt="" style="padding: 20px; width: 400px;" /></div> <h2 id="conclusion">Conclusion</h2> <p>Overall it was a very interesting project that was fun to build and is also fun to use every once in a while. When there is a lot of people playing it’s a real mess, but it was expected and is also very funny to watch.</p> <p>Something I didn’t anticipate was that, while I love coding with music, for this project I absolutely couldn’t. Instead I spent a couple of days listening to beepings and sine waves. The worse was when I introduced bugs and a piercing noise would destroy my ears.</p> <p>It’s also worth mentioning that I won the <a href="https://twitter.com/rbrampage/status/795007525733023744">popularity prize</a> of the hackathon, so I’d say the whole experience was a success!</p> <div id="more"> <div id="more-articles"> <p>Since you scrolled this far, you might be interested in some other things I wrote:</p> <ul> <li><a href="/blog/2016/11/01/javascript-audio/">Generate Sounds Programmatically With Javascript</a></li> <li><a href="/blog/2016/03/14/github-pages-jekyll/">Trailing Slashes, Github Pages, Jekyll 3 & 404s</a></li> <li><a href="/blog/2016/03/01/vimrc-example/">Vim Configuration From Scratch in 2016</a></li> <li><a href="/blog/2015/01/05/css-animations-failing-capybara-specs/">How CSS Animations Can Break Your Tests</a></li> <li><a href="/blog/2014/07/22/in-defense-of-legacy-code/">Some Respect For Legacy Code</a></li> <li><a href="/blog/2014/04/28/frame-based-layout-bad-code/">Tips on Creating a Website From When I Was 12</a></li> <li><a href="/blog/2013/11/05/enough-with-the-language-trolls/">Enough With The Trolls</a></li> <li><a href="/blog/2013/03/25/please-changelog-open-source/">Please Keep a Changelog For Your Open Source Lib</a></li> <li><a href="/blog/2012/09/04/one-reason-to-switch-to-vim-editor/">The One Thing That Made Me Switch To Vim</a></li> <li><a href="/books/">Startup & Tech Book Reviews</a> </ul> </div> <div class="container comments" id="comments"> Loading comments... </div> <div id="comment_form_wrapper" class="container"> <form id="comment_form"> <textarea name="content" required id="comment_content" placeholder="Leave a comment"/></textarea /> <div id="comment_additional" class="row" style="display: none;"> <div class="col-sm-4"> <input type="text" id="comment_name" required placeholder="Your name*" /> </div> <div class="col-sm-4"> <input type="text" id="comment_website" placeholder="Your site" /> </div> <div class="col-sm-4"> <input type="email" id="comment_email" required placeholder="Your email* (won't be displayed)" /> </div> </div> <br /> <input type="submit" id="submit_comment" value="Send"/> <div id="submit_loading" style="display: none;">...</div> </form> </div> </div> </div> </div> </div> <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script> <script src="/assets/js/comments.js"></script> <link rel="preload" href="/assets/css/code.css" as="style" onload="this.rel='stylesheet'"> <link href="/assets/css/comments.css?body=1" rel="stylesheet" type="text/css" media="all"> <script> /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */ !function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this); /*! loadCSS rel=preload polyfill. [c]2017 Filament Group, Inc. MIT License */ !function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this); </script> <footer> <div>Website powered by <a href="https://github.com/jekyll/jekyll">Jekyll</a>, hosted on <a href="https://github.com/marcgg/marcgg.github.com">Github</a>. <br> All of the <a href="/blog">blog's articles</a>, <a href="/status">status</a> and site content in general is under Copyright &copy;. <br> If you want to use this content, please contact me.</div> </footer> <script type="text/javascript"> var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-31071519-1']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })(); </script> </body> </html>


<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <title> Web Views &amp; RubyMotion </title> <meta name="description" content="In this article I'll explain how to use UIWebViews using RubyMotion. This includes loading URLs, local files and communicating with them via Javascript."> <meta name="author" content="Marc G Gauthier"> <meta content='user-scalable=no, width=device-width, initial-scale=1.0' name='viewport'> <meta name="google-site-verification" content="x2EpQdOMz-k9fP8hak9I3COaXhnQ4jNLp2GU4GYQ8jM" /> <link href='//fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic|Open+Sans:300italic,700italic,400,700,300' rel='stylesheet' type='text/css'> <link href="/atom.xml" rel="alternate" type="application/atom+xml" title="Marcgg#Blog"> <link rel="shortcut icon" href="/assets/favicon.png"> <style type="text/css"> /* http://meyerweb.com/eric/tools/css/reset/ v2.0 | 20110126 License: none (public domain) */ html, body, div, span, applet, object, iframe, h1, h2, h3, h4, h5, h6, p, blockquote, pre, a, abbr, acronym, address, big, cite, code, del, dfn, em, img, ins, kbd, q, s, samp, small, strike, strong, sub, sup, tt, var, b, u, i, center, dl, dt, dd, ol, ul, li, fieldset, form, label, legend, table, caption, tbody, tfoot, thead, tr, th, td, article, aside, canvas, details, embed, figure, figcaption, footer, header, hgroup, menu, nav, output, ruby, section, summary, time, mark, audio, video { margin: 0; padding: 0; border: 0; font-size: 100%; font: inherit; vertical-align: baseline; } /* HTML5 display-role reset for older browsers */ article, aside, details, figcaption, figure, footer, header, hgroup, menu, nav, section { display: block; } body { line-height: 1; } ol, ul { list-style: none; } blockquote, q { quotes: none; } blockquote:before, blockquote:after, q:before, q:after { content: ''; content: none; } table { border-collapse: collapse; border-spacing: 0; } .clearfix:after { content: "."; display: block; clear: both; visibility: hidden; line-height: 0; height: 0; } .clearfix { display: inline-block; } html[xmlns] .clearfix { display: block; } * html .clearfix { height: 1%; } @font-face { font-family: 'anonymousregular'; src: url('/assets/fonts/Anonymous-webfont.eot'); src: url('/assets/fonts/Anonymous-webfont.eot?#iefix') format('embedded-opentype'), url('/assets/fonts/Anonymous-webfont.woff') format('woff'), url('/assets/fonts/Anonymous-webfont.ttf') format('truetype'), url('/assets/fonts/Anonymous-webfont.svg#anonymousregular') format('svg'); font-weight: normal; font-style: normal; } body{ font-size: 15px; font-family: 'Droid Serif', serif; color: #545454; line-height: 25px; } #gradient{ height: 5px; background: rgba(237,82,82,0.64); background: -moz-linear-gradient(left, rgba(237,82,82,0.64) 0%, rgba(250,21,0,0.65) 20%, rgba(237,82,82,0.66) 52%, rgba(255,21,0,0.66) 80%, rgba(237,82,82,0.67) 100%); background: -webkit-gradient(left top, right top, color-stop(0%, rgba(237,82,82,0.64)), color-stop(20%, rgba(250,21,0,0.65)), color-stop(52%, rgba(237,82,82,0.66)), color-stop(80%, rgba(255,21,0,0.66)), color-stop(100%, rgba(237,82,82,0.67))); background: -webkit-linear-gradient(left, rgba(237,82,82,0.64) 0%, rgba(250,21,0,0.65) 20%, rgba(237,82,82,0.66) 52%, rgba(255,21,0,0.66) 80%, rgba(237,82,82,0.67) 100%); background: -o-linear-gradient(left, rgba(237,82,82,0.64) 0%, rgba(250,21,0,0.65) 20%, rgba(237,82,82,0.66) 52%, rgba(255,21,0,0.66) 80%, rgba(237,82,82,0.67) 100%); background: -ms-linear-gradient(left, rgba(237,82,82,0.64) 0%, rgba(250,21,0,0.65) 20%, rgba(237,82,82,0.66) 52%, rgba(255,21,0,0.66) 80%, rgba(237,82,82,0.67) 100%); background: linear-gradient(to right, rgba(237,82,82,0.64) 0%, rgba(250,21,0,0.65) 20%, rgba(237,82,82,0.66) 52%, rgba(255,21,0,0.66) 80%, rgba(237,82,82,0.67) 100%); filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#ed5252', endColorstr='#ed5252', GradientType=1 ); } /* STRUCTURE */ #container{ background-color: #fafafa; } #content{ width: 760px; margin: auto; margin-top: 20px; padding-bottom: 60px; padding-top: 40px; } /* FOOTER */ footer{ padding: 40px 0px; text-align: center; border-top: 1px solid #e6e6e6; font-size: 0.8em; color: #9a9a9a; background-color: #fafafa; } footer a{ color: #9a9a9a; } /* HEADER */ header{ width: 760px; margin: auto; height: 50px; border-bottom: 1px solid #f1f1f1; position: relative; } #more-nav{ font-size: 0.75em; display: inline-block;; position: absolute; top: 0px; font-family: "anonymousregular"; padding-top: 5px; right: 0px; } #more-nav a{ padding: 0px 2px; text-decoration: none; color: #545454; } #more-nav a:hover{ transition: 0s; background-image: linear-gradient(to bottom, #fff 30%, rgba(200, 200, 200, 0.4) 50%); background-repeat: repeat-x; background-size: 2px 2px; background-position: 0px 100%; } #more-nav .selected{ color: #ed5252; font-weight: bold; } #logo{ font-size: 1.2em; font-family: "anonymousregular"; margin-top: 20px; } #logo *{ text-decoration: none; } #logo1{ color: #999; } #logo2{ font-size: 0.8em; color: #ed5252; } #logo3{ color: #545454; } #logo a:hover{ color: #ed5252; transition-duration: 1s; } /* TEXT STRUCTURE */ h1, h2, h3, h4, h5{ font-family: 'Open Sans', sans-serif; color: #1c1c1c; } h2, h3, h4, h5{ text-transform: capitalize; } a:hover{ color: #ed5252; transition-duration:0.2s; } p a, ul a, .review a{ color: #763232; text-decoration: none; background-image: linear-gradient(to bottom, #fff 30%, rgba(200, 200, 200, 0.4) 50%); background-repeat: repeat-x; background-size: 2px 2px; background-position: 0px 100%; } p{ text-align: justify; margin-bottom: 20px; } .excerpt p{ margin-bottom: 0px; } .footnote, .sidenote{ margin: 40px 0px; color: #858585; text-align: right; font-size: 0.9em; font-style: italic; } .image_notes{ text-align: center; color: #858585; font-size: 0.9em; margin: -5px 0px 15px 0px; } h1{ font-size: 2.45em; text-align: center; margin: 70px 0px 20px 0px; line-height : 1.5em; } h1 em{ color: #888; font-weight: normal; font-size: 0.8em; } h2{ font-size: 1.75em; margin: 50px 0px 50px 0px; line-height: 1.75em; } h2::before{ content: "#"; color: #ed5252; font-family: "anonymousregular"; display: inline-block; float: left; padding: 3px 10px 0px 0px; font-size: 0.7em; } h3{ font-size: 1.35em; margin-bottom: 20px; } h4{ font-size: 1.2em; margin-bottom: 20px; font-style: italic; } h5{ font-size: 1.3em; margin-bottom: 20px; } h5 *{ color: #545454; } em{ font-style: italic; } strong{ font-weight: bold; } blockquote{ border-left: 3px solid #ddd; color: #888; margin: 0px 0px 20px 40px; font-style: italic; } blockquote p{ margin: 5px 20px !important; } ul{ padding-left: 40px; line-height: 25px; list-style: square; margin-bottom: 20px; } li{ display: list-item; } ol{ padding-left: 40px; line-height: 25px; margin-bottom: 20px; list-style-type: decimal; } /* TAGS */ .home-tag { font-size: 10px; display: inline-block; border: 1px solid #dedede; padding: 2px 2px 1px 2px; border-radius: 2px; line-height: 10px; margin-left: 1px; } .tag-date{ color: #dedede; } .tag-management { border-color: #929aff; color: #929aff; } .tag-programming { border-color: #ff9292; color: #ff9292; } .tag-coaching { border-color: #4ec698; color: #4ec698; } .tag-projectmanagement { border-color: #929aff; color: #929aff; } /* BLOG INDEX */ #all-posts{ margin: 0px auto 10px auto; width: 760px; } .single-post{ border-top: 1px solid #f1f1f1; padding: 40px 0px; float: clear; } .single-post:first-child{ border-top: none !important; } .single-post .date{ color: #cdcdcd; margin-top: 10px; float: right; } .single-post .author{ color: #cdcdcd; float: right; font-size: 0.7em; } .single-post .title{ font-family: 'Open Sans', sans-serif; font-size: 1.6em; margin-bottom: 20px; line-height: 1.6em; position: relative; } .single-post .title a{ color: #545454; text-decoration: none; } .single-post .title a::before{ content: "→"; opacity: 0; font-family: "anonymousregular"; font-size: 0.7em; position: absolute; left: -30px; transition: all .4s ease-in-out; } .single-post .title a:hover::before{ opacity: 1; transition: all .4s ease-in-out; color: #ed5252; } .single-post .title em{ display: none; } .data_table{ border: 1px solid #efefef; font-family: "anonymousregular"; font-size: 12px; margin: auto auto 20px auto; } .data_table tr{ border: 1px solid #efefef; } .data_table th{ background-color: #efefef; } .data_table th, .data_table td{ padding: 2px 5px; } /* BOOKS */ .book-cover-entry{ width: 120px; margin-right: 20px; float: left; font-size: 12px; text-decoration: none !important; } .buy-book{ text-decoration: underline; } .book-cover-entry img{ width: 120px; } .book-cover-entry { background-image: none; } .book-rating .icon { display: inline-block; padding-right: 5px; } .book-rating .top .icon{ color: #1CED00; } .book-rating .good .icon{ color: #82ED00; } .book-rating .medium .icon{ color: #EDD100; } .book-rating .low .icon{ color: #EDAE00; } .book-rating .poor .icon{ color: #ED3B00; } #buy-title{ padding: 0px 0px 25px 0px; } #buy-title span{ font-size: 0.8em !important; color: #cdcdcd; } #buy-popin{ padding: 30px 15px; } .store{ display: block; padding: 15px 5px; text-decoration: none; } .store:hover{ color: #ed5252; } #upcoming-books{ padding-top: 20px; } #upcoming-books img{ height: 90px; margin-right: 10px; border: 1px solid #fff; } #upcoming-books a{ text-decoration: none; } #upcoming-books img:hover{ border: 1px solid #ed5252; } /* BLOG SHOW */ .post{ padding-top: 20px; } p code, li code{ background-color: #efefef; font-family: "Lucida Console", "Courier New", Courier, monospace; padding: 1px 2px; font-size: 13px; } .post img{ border: 1px solid #e6e6e6; padding: 5px; margin: 0px 0px 20px 20px; } .published span{ border-top: 1px solid #e6e6e6; display: inline-block; color: #858585; padding-top: 5px; font-family: 'Open Sans', sans-serif; font-size: 0.9em; padding: 5px 20px 0px 20px; } .published{ text-align: center; margin-bottom: 25px; } #more{ border-top: 1px solid #e6e6e6; margin-top: 40px; padding: 40px 0px; } #more-articles{ margin-bottom: 40px; } .image-wrapper em{ display: block; font-size: 0.8em; margin: -20px 0px 20px 0px; color: #aaa; } .twitter-tweet{ margin: auto; max-width: 420px !important; } #book-review{ border: 1px dashed #dedede; padding: 20px; margin-bottom: 20px; opacity: 0.7; font-style: italic; } /* Music */ .js_play_sound, .js_stop_sound{ display: inline-block; padding: 4px 10px 2px 10px; border: 1px solid #efefef; background-color: #efefef; margin-right: 10px; text-decoration: none; border-radius: 3px; font-family: 'anonymousregular'; font-size: 12px; } .js_play_sound:hover, .js_stop_sound:hover{ background-color: #dedede; } /* Comments */ #comments{ padding-top: 20px; } #show-disqus-arrow{ color: #ed5252; } /* CLEARFIX */ .cf:before, .cf:after { content: " "; /* 1 */ display: table; /* 2 */ } .cf:after { clear: both; } /************************ MOBILE LAYOUT *********************/ @media all and (max-width: 800px) { .home-tag { display: none; } .author{ float: none !important; display: inline; } header{ width: 92%; padding: 4%; height: 75px; position: relative; text-align: center; background-color: #fafafa; } #more-nav{ left: 0px; top: 50px; } #logo{ margin-top: 10px; } #content, #all-posts{ width: 92%; padding: 4%; } .image-wrapper{ width: 100%; } .image-wrapper img, .post div img, .post p img{ max-width: 100% !important; padding: 15px 0px !important; margin: 20px 0px 20px 0px !important; border-right: 0px; border-left: 0px; } .single-post .title{ font-size: 1.4em; } .date{ display: none; } h1{ font-size: 1.7em; width: 94%; padding: 3%; } h2{ font-size: 1.50em; margin: 30px 0px 30px 0px; line-height: 1.75em; } h3{ font-size: 1.30em; } blockquote{ margin: 0px 0px 20px 0px !important; } pre{ margin-left: 0px !important; margin-right: 0px !important; width: 90%; overflow-x: scroll; } code{ width: 100%; font-size: 13px !important; } footer div{ display: inline; } /* Hire me responsive */ #hire ul{ padding-left: 15px; } #talking-img{ width: 100%; } #talking-img img{ width: 100% !important; } #reviews{ border-top: 1px dashed #e6e6e6; padding: 15px 0px 15px 0px; } #references_logo{ padding: 0px 0px 15px 0px; } .review{ width: 100%; margin: 0px 0px 15px 0px; padding: 0px; border-bottom: 1px dashed #e6e6e6; } #references_logo img, #references_logo .minor{ width: 22%; float: left; margin: 15px 2% 15px 0px; } .data_table th, .data_table td{ font-size: 8px; padding: 0px; border: 1px solid #efefef; } } </style> </head> <body> <div id="gradient"></div> <header> <div id="logo"> <a id='logo1' href="/">marcgg</a> <span id='logo2'>#</span> <a id='logo3' href="/blog/"> blog </a> </div> <div id="more-nav"> &rarr; <a href="/blog/" class="selected">blog</a> &rarr; <a href="/books/" class="">books</a> &rarr; <a href="/hire/" class="">hire me</a> </div> </header> <h1> <span> Web Views &amp; RubyMotion </span> </h1> <div class="published"> <span>12 November 2012</span> </div> <div id="container"> <div id="content"> <div class="post" id="post-"> <p>Here we go, another article on <a href="http://www.rubymotion.com/">RubyMotion</a>! For those of you that don’t know what’s that’s all about, it’s a toolchain created by <a href="https://twitter.com/lrz">Laurent Sansonetti</a> (of <a href="http://macruby.org/">MacRuby</a> fame) allowing you to create native iOS application using <a href="http://www.ruby-lang.org/">Ruby</a>.</p> <p>I like it a lot, but please keep in mind that while I have a decent knowledge of Ruby, I’m only using RubyMotion on a side project. I worked hard to get everything here to work, but it still might not be the most efficient way of doing it. If you do know a better solution, please share it in the comments and I’ll update the article.</p> <h2 id="our-objective">Our Objective</h2> <p>Right now the general feeling is that in order to get the highest level of quality in an app, you have to go native. I’m not disputing that, but there are some cases where you just need to have some HTML, JS and CSS displaying. To do that, the best way is to use the <a href="http://developer.apple.com/library/ios/#documentation/uikit/reference/UIWebView_Class/Reference/Reference.html">UIWebView</a> element. It allows you to open html file and display them as if you were in a browser.</p> <p>In this article I’ll try to demonstrate how to:</p> <ul> <li>Open a given website in a simple web view within a RubyMotion project.</li> <li>Open a locally stored HTML file</li> <li>Customize a bit the feel of the web view</li> <li>Send a signal from the web view back to the application</li> </ul> <h2 id="prerequisites">Prerequisites</h2> <p>I won’t get into the details on how to set up a project and will assume you have basic knowledge of how this works. If you never created something with RubyMotion, please take a look at <a href="http://rubymotion-tutorial.com/1-hello-motion/">this tutorial</a> before reading the rest of this article.</p> <p>RubyMotion uses <a href="http://www.ruby-lang.org/">Ruby</a>. If you are not familiar with it, there are tons of tutorials and books on how to code with this language. I recommend <a href="http://ruby.learncodethehardway.org/">Learn Ruby The Hard Way</a> by <a href="http://zedshaw.com/">Zed A. Shaw</a>.</p> <h2 id="setting-up-the-appdelegate">Setting up the AppDelegate</h2> <p>This is pretty basic, we just set up a <a href="http://rubymotion-tutorial.com/3-controllers/">controller</a> and assign it to be the root.</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">AppDelegate</span>
  <span class="k">def</span> <span class="nf">application</span><span class="p">(</span><span class="n">application</span><span class="p">,</span> <span class="n">didFinishLaunchingWithOptions</span><span class="ss">:launchOptions</span><span class="p">)</span>
	<span class="vi">@window</span> <span class="o">=</span> <span class="no">UIWindow</span><span class="p">.</span><span class="nf">alloc</span><span class="p">.</span><span class="nf">initWithFrame</span><span class="p">(</span><span class="no">UIScreen</span><span class="p">.</span><span class="nf">mainScreen</span><span class="p">.</span><span class="nf">bounds</span><span class="p">)</span>
	
	<span class="n">main_controller</span> <span class="o">=</span> <span class="no">MainController</span><span class="p">.</span><span class="nf">alloc</span><span class="p">.</span><span class="nf">init</span>
	<span class="vi">@window</span><span class="p">.</span><span class="nf">rootViewController</span> <span class="o">=</span> <span class="n">main_controller</span>
	
	<span class="vi">@window</span><span class="p">.</span><span class="nf">rootViewController</span><span class="p">.</span><span class="nf">wantsFullScreenLayout</span> <span class="o">=</span> <span class="kp">true</span>
	<span class="vi">@window</span><span class="p">.</span><span class="nf">makeKeyAndVisible</span>
	<span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure> <h2 id="opening-a-given-url">Opening A Given URL</h2> <p>We’ll create the structure for a basic controller and set its view to be a UIWebView. Then we’ll build an URL and load it.</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">MainController</span> <span class="p">\</span><span class="o">&lt;</span> <span class="no">UIViewController</span>

  <span class="k">def</span> <span class="nf">initWithNibName</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="ss">bundle: </span><span class="n">bundle</span><span class="p">)</span>
	<span class="k">super</span>
	<span class="nb">self</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">loadView</span>
	<span class="nb">self</span><span class="p">.</span><span class="nf">view</span> <span class="o">=</span> <span class="no">UIWebView</span><span class="p">.</span><span class="nf">alloc</span><span class="p">.</span><span class="nf">init</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">viewDidLoad</span>
	<span class="nb">self</span><span class="p">.</span><span class="nf">view</span><span class="p">.</span><span class="nf">loadRequest</span><span class="p">(</span>
	  <span class="no">NSURLRequest</span><span class="p">.</span><span class="nf">requestWithURL</span><span class="p">(</span><span class="no">NSURL</span><span class="o">.</span><span class="no">URLWithString</span><span class="p">(</span><span class="s2">"http://marcgg.com"</span><span class="p">))</span>
	<span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure> <p class="sidenote"> EDIT: I moved the UIWebView.alloc.init to loadView to avoid creating a UIView just to throw it away. Thanks to <a href="https://twitter.com/colinta">Colin</a> for pointing this out. </p> <p>If we slow down things a bit, we have this:</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Creating a URL</span>
<span class="n">url</span> <span class="o">=</span> <span class="no">NSURL</span><span class="o">.</span><span class="no">URLWithString</span><span class="p">(</span><span class="s2">"http://marcgg.com"</span><span class="p">)</span>

<span class="c1"># Creating a request based on the URL</span>
<span class="n">request</span> <span class="o">=</span> <span class="no">NSURLRequest</span><span class="p">.</span><span class="nf">requestWithURL</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="c1"># Loading the request into the view (that is set to be our UIWebView)</span>
<span class="nb">self</span><span class="p">.</span><span class="nf">view</span><span class="p">.</span><span class="nf">loadRequest</span><span class="p">(</span><span class="n">request</span><span class="p">)</span></code></pre></figure> <p>Now if we run rake we see my website, and how badly it’s optimized for mobile:</p> <div style="text-align: center"><img src="/assets/misc/uiweb1.png" /></div> <h2 id="opening-a-local-file">Opening A Local File</h2> <p>It’s good to open a website, but what if you don’t have internet access, or if you don’t need to load anything since you have already everything you need ? That’s when you load your locally stored file.</p> <p>First, create an <code class="highlighter-rouge">index.html</code> file that you’ll store in <code class="highlighter-rouge">/resources</code>. Put whatever HTML you want inside, maybe a background color or something similar to know if the file loaded properly.</p> <p>Once it’s done, tweak the controller so that it knows what’s up.</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">viewDidLoad</span>
  <span class="n">path</span> <span class="o">=</span> <span class="no">NSBundle</span><span class="p">.</span><span class="nf">mainBundle</span><span class="p">.</span><span class="nf">pathForResource</span><span class="p">(</span><span class="s1">'index'</span><span class="p">,</span> <span class="ss">ofType: </span><span class="s1">'html'</span><span class="p">)</span>
  <span class="n">url</span> <span class="o">=</span> <span class="no">NSURL</span><span class="p">.</span><span class="nf">fileURLWithPath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
  <span class="nb">self</span><span class="p">.</span><span class="nf">view</span><span class="p">.</span><span class="nf">loadRequest</span> <span class="no">NSURLRequest</span><span class="p">.</span><span class="nf">requestWithURL</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="k">end</span></code></pre></figure> <p>Run rake again, and you should see your file displaying.</p> <div style="text-align: center"><img src="/assets/misc/uiweb2.png" /></div> <p>At this point you can customize the HTML however you want. Keep in mind that if you use other files (css, js, images), they need to be stored in <code class="highlighter-rouge">/ressources</code> as well in order to be accessible. You might also need to think about how you want to handle retina/non retina images.</p> <h2 id="customize-the-uiwebview">Customize The UIWebView</h2> <p>Here what I wanted to do is to forbid scrolling and just have a nice, fixed, piece of HTML. This way it’ll feel more like a native piece of UI than a web browser. To do so, you can change these parameters:</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">self</span><span class="p">.</span><span class="nf">view</span><span class="p">.</span><span class="nf">scrollView</span><span class="p">.</span><span class="nf">scrollEnabled</span> <span class="o">=</span> <span class="kp">false</span>
<span class="nb">self</span><span class="p">.</span><span class="nf">view</span><span class="p">.</span><span class="nf">scrollView</span><span class="p">.</span><span class="nf">bounces</span> <span class="o">=</span> <span class="kp">false</span></code></pre></figure> <h2 id="javascript-communication">Javascript Communication</h2> <p>It’s the part where it gets a bit more tricky. Here I want to have a link somewhere in my HTML that triggers something in my RubyMotion code. It could be a “cancel” link, a form… it doesn’t matter.</p> <p>To do that we’re going to use the logic behind <code class="highlighter-rouge">shouldStartLoadWithRequest</code> and the whole <a href="http://developer.apple.com/library/ios/#documentation/uikit/reference/UIWebViewDelegate_Protocol/Reference/Reference.html">UIWebViewDelegate</a> thing. I’m not an iOS master yet, so please bear with me on the domain-specific vocabulary.</p> <p>First we’re going to add a delegate to our view. Here I’ll use the current controller because it’s a rather small project, but feel free to use any object you want.</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">self</span><span class="p">.</span><span class="nf">view</span><span class="p">.</span><span class="nf">delegate</span> <span class="o">=</span> <span class="nb">self</span></code></pre></figure> <p>Now we can use the fact that our controller, being the delegate of a UIWebview, will have its shouldStartLoadWithRequest method called before any frame is loaded. Let’s write our own method and see how it goes.</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">webView</span><span class="p">(</span><span class="n">inWeb</span><span class="p">,</span> <span class="ss">shouldStartLoadWithRequest: </span><span class="n">inRequest</span><span class="p">,</span> <span class="ss">navigationType: </span><span class="n">inType</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="n">inRequest</span><span class="o">.</span><span class="no">URL</span><span class="p">.</span><span class="nf">absoluteString</span>
  <span class="kp">true</span>
<span class="k">end</span></code></pre></figure> <p>Here we have the bare minimum to get started. You’ll notice we have a couple of parameters. In this article I’ll just use the request, but know that the others can be usefull too. Read the <a href="http://developer.apple.com/library/ios/#documentation/uikit/reference/UIWebViewDelegate_Protocol/Reference/Reference.html">documentation</a> if you want to learn more.</p> <p>Now if we launch rake one more time and look at the trace, we can see the current path to the local file we’re loading.</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="p">(</span><span class="n">main</span><span class="p">)\</span><span class="o">&gt;</span> <span class="n">file</span><span class="ss">:/</span><span class="o">/</span><span class="n">your</span><span class="p">\</span><span class="n">_path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">your</span><span class="p">\</span><span class="n">_project</span><span class="p">.</span><span class="nf">app</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="nf">html</span></code></pre></figure> <p>This is useless, but now let’s add a link in the <code class="highlighter-rouge">index.html</code> file. Now if you point it to a regular website, it’ll just load it. It’s not what we want right now. Instead we’ll create our own protocol (lol) as such:</p> <figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"myapp://do/something"</span><span class="nt">&gt;</span>Click this<span class="nt">&lt;/a&gt;</span></code></pre></figure> <p>By now you must have figured out where we’re heading like that. Since we have our callback thanks to the UIWebViewDelegate protocol, we can parse the URL and do process it how we want. I added a basic example below, but really you can do whatever.</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">webView</span><span class="p">(</span><span class="n">inWeb</span><span class="p">,</span> <span class="ss">shouldStartLoadWithRequest: </span><span class="n">inRequest</span><span class="p">,</span> <span class="ss">navigationType: </span><span class="n">inType</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">inRequest</span><span class="o">.</span><span class="no">URL</span><span class="p">.</span><span class="nf">absoluteString</span> <span class="o">=</span><span class="p">\</span><span class="o">~</span> <span class="sr">/myapp:\/\//</span>
	<span class="nb">puts</span> <span class="s2">"Do something!"</span>
  <span class="k">else</span>
	<span class="nb">puts</span> <span class="s2">"This is just another link"</span>
  <span class="k">end</span>
  <span class="kp">true</span>
<span class="k">end</span></code></pre></figure> <p>In the same fashion you can trigger the page change using javascript. This should be pretty basic stuff here.</p> <figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nb">window</span><span class="p">.</span><span class="nx">location</span> <span class="o">=</span> <span class="s2">"myapp://some\_awesome/message"</span></code></pre></figure> <p>By now you should have noticed how I always return true. It’s because if you return false the frame won’t load. You can use this fact to forbid the user to click certain links on the page, or disable browsing altogether.</p> <h2 id="a-quick-security-note">A Quick Security Note</h2> <p>We now have an HTML page talking to your iOS app ! Pretty cool, but be carefull on how you allow this to happen, since you really don’t want any website sending funky signals to your app. Make sure you don’t execute any message you receive.</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">webView</span><span class="p">(</span><span class="n">inWeb</span><span class="p">,</span> <span class="ss">shouldStartLoadWithRequest: </span><span class="n">inRequest</span><span class="p">,</span> <span class="ss">navigationType: </span><span class="n">inType</span><span class="p">)</span>
  <span class="p">\</span><span class="c1"># I'm an Idiot</span>
  <span class="no">MyVeryImportantModel</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">inRequest</span><span class="o">.</span><span class="no">URL</span><span class="p">.</span><span class="nf">absoluteString</span><span class="p">)</span>
<span class="k">end</span></code></pre></figure> <p>It should be pretty obvious, but it’s still worth mentioning.</p> <h2 id="hurray-">Hurray !</h2> <p>We now have a web view loading a local file and talking to the Ruby part of the application using Javascript. Neat ! Of course there’s a lot more you can do with this, and you should probably add some kind of cool DSL in front of it if you’re going to do this frequently.</p> <p>As always, you can look up the whole project on <a href="https://github.com/marcgg/rubymotion-uiwebview">github</a>. It is compiling and working as I write this article, but keep in mind that RubyMotion is a fast moving project and it might not be the case in a few months.</p> <div id="more"> <div id="more-articles"> <p>Since you scrolled this far, you might be interested in some other things I wrote!</p> <ul> <li><a href="/blog/2014/04/09/phonegap-steroids-hybrid-native-app-tips/">Tips & Tricks Learned Releasing an Hybrid App Using&nbsp;Steroids.js</a></li> <li><a href="/blog/2013/08/29/appgyver-steroids-iphone-hybrid-javascript/">My First Impressions of AppGyver's Steroids.js</a></li> <li><a href="/blog/2012/10/22/custom-slider-ios-rubymotion/">Create a Custom Slider With RubyMotion</a></li> <li><a href="/books/">Startup & Tech Book Reviews</a> </ul> </div> <a href="https://twitter.com/marcgg" class="twitter-follow-button" data-show-count="false" data-size="large">Follow @marcgg</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script> <a href="https://twitter.com/share" class="twitter-share-button" data-via="marcgg" data-size="large">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script> </div> <div id="comments"> <style id="disqus_hide"> #disqus_thread{ display: none; } </style> <p> <span id="show-disqus-arrow">&rarr; </span> <a href="#" id="show-disqus">Read the comments or contribute with your own</a> </p> <div id="disqus_thread"></div> </div> <script type="text/javascript"> var disqus_shortname = 'marcgg'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); </script> </div> </div> </div> <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script> <script src="/assets/js/comments.js"></script> <link rel="preload" href="/assets/css/code.css" as="style" onload="this.rel='stylesheet'"> <script> /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */ !function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this); /*! loadCSS rel=preload polyfill. [c]2017 Filament Group, Inc. MIT License */ !function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this); </script> <footer> <div>Website powered by <a href="https://github.com/jekyll/jekyll">Jekyll</a>, hosted on <a href="https://github.com/marcgg/marcgg.github.com">Github</a> and put together by <a href="http://twitter.com/marcgg">@marcgg</a>.</div> <div>All of the <a href="/blog">blog's articles</a> are under <a href="http://creativecommons.org/licenses/by-sa/3.0/">Creative commons</a> license unless stated otherwise. Everything else is &copy;.</div> </footer> <script type="text/javascript"> var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-31071519-1']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })(); </script> </body> </html>


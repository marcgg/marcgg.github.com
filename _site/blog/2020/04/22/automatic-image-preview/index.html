<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <title> Generating Custom Image Previews For Social Media </title> <meta name="description" content="I wanted to have nice looking social media link previews for Linkedin, Twitter and Facebook... but I also didn't want to create them manually for each articles. Here's how I did it programatically with stock photos, Ruby scripts, the Jekyll static site generator and a Duotone tool!"> <meta name="author" content="Marc G Gauthier"> <meta content='user-scalable=no, width=device-width, initial-scale=1.0' name='viewport'> <meta name="google-site-verification" content="x2EpQdOMz-k9fP8hak9I3COaXhnQ4jNLp2GU4GYQ8jM" /> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:site" content="@marcgg"> <meta name="twitter:creator" content="@marcgg"> <meta name="twitter:title" content="Generating Custom Image Previews For Social Media"> <meta name="twitter:description" content="I wanted to have nice looking social media link previews for Linkedin, Twitter and Facebook... but I also didn't want to create them manually for each articles. Here's how I did it programatically with stock photos, Ruby scripts, the Jekyll static site generator and a Duotone tool!"> <meta name="twitter:image" content="https://marcgg.com/assets/previews/2020-04-22-automatic-image-preview.jpg" /> <meta name="image" property="og:image" content="https://marcgg.com/assets/previews/2020-04-22-automatic-image-preview.jpg" /> <link href='//fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic|Open+Sans:300italic,700italic,400,700,300' rel='stylesheet' type='text/css'> <link href="/atom.xml" rel="alternate" type="application/atom+xml" title="Marcgg#Blog"> <link rel="shortcut icon" href="/assets/favicon.png"> <style type="text/css"> /* http://meyerweb.com/eric/tools/css/reset/ v2.0 | 20110126 License: none (public domain) */ html, body, div, span, applet, object, iframe, h1, h2, h3, h4, h5, h6, p, blockquote, pre, a, abbr, acronym, address, big, cite, code, del, dfn, em, img, ins, kbd, q, s, samp, small, strike, strong, sub, sup, tt, var, b, u, i, center, dl, dt, dd, ol, ul, li, fieldset, form, label, legend, table, caption, tbody, tfoot, thead, tr, th, td, article, aside, canvas, details, embed, figure, figcaption, footer, header, hgroup, menu, nav, output, ruby, section, summary, time, mark, audio, video { margin: 0; padding: 0; border: 0; font-size: 100%; font: inherit; vertical-align: baseline; } /* HTML5 display-role reset for older browsers */ article, aside, details, figcaption, figure, footer, header, hgroup, menu, nav, section { display: block; } body { line-height: 1; } ol, ul { list-style: none; } blockquote, q { quotes: none; } blockquote:before, blockquote:after, q:before, q:after { content: ''; content: none; } table { border-collapse: collapse; border-spacing: 0; } .clearfix:after { content: "."; display: block; clear: both; visibility: hidden; line-height: 0; height: 0; } .clearfix { display: inline-block; } html[xmlns] .clearfix { display: block; } * html .clearfix { height: 1%; } @font-face { font-family: 'anonymousregular'; src: url('/assets/fonts/Anonymous-webfont.eot'); src: url('/assets/fonts/Anonymous-webfont.eot?#iefix') format('embedded-opentype'), url('/assets/fonts/Anonymous-webfont.woff') format('woff'), url('/assets/fonts/Anonymous-webfont.ttf') format('truetype'), url('/assets/fonts/Anonymous-webfont.svg#anonymousregular') format('svg'); font-weight: normal; font-style: normal; } body{ font-size: 15px; font-family: 'Droid Serif', serif; color: #353535; line-height: 25px; } #gradient{ height: 5px; background: rgba(237,82,82,0.64); background: -moz-linear-gradient(left, rgba(237,82,82,0.64) 0%, rgba(250,21,0,0.65) 20%, rgba(237,82,82,0.66) 52%, rgba(255,21,0,0.66) 80%, rgba(237,82,82,0.67) 100%); background: -webkit-gradient(left top, right top, color-stop(0%, rgba(237,82,82,0.64)), color-stop(20%, rgba(250,21,0,0.65)), color-stop(52%, rgba(237,82,82,0.66)), color-stop(80%, rgba(255,21,0,0.66)), color-stop(100%, rgba(237,82,82,0.67))); background: -webkit-linear-gradient(left, rgba(237,82,82,0.64) 0%, rgba(250,21,0,0.65) 20%, rgba(237,82,82,0.66) 52%, rgba(255,21,0,0.66) 80%, rgba(237,82,82,0.67) 100%); background: -o-linear-gradient(left, rgba(237,82,82,0.64) 0%, rgba(250,21,0,0.65) 20%, rgba(237,82,82,0.66) 52%, rgba(255,21,0,0.66) 80%, rgba(237,82,82,0.67) 100%); background: -ms-linear-gradient(left, rgba(237,82,82,0.64) 0%, rgba(250,21,0,0.65) 20%, rgba(237,82,82,0.66) 52%, rgba(255,21,0,0.66) 80%, rgba(237,82,82,0.67) 100%); background: linear-gradient(to right, rgba(237,82,82,0.64) 0%, rgba(250,21,0,0.65) 20%, rgba(237,82,82,0.66) 52%, rgba(255,21,0,0.66) 80%, rgba(237,82,82,0.67) 100%); filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#ed5252', endColorstr='#ed5252', GradientType=1 ); } /* STRUCTURE */ #container{ background-color: #fafafa; } #content{ width: 760px; margin: auto; margin-top: 40px; padding-bottom: 60px; padding-top: 40px; } /* FOOTER */ footer{ padding: 40px 0px; text-align: center; border-top: 1px solid #e6e6e6; font-size: 0.8em; color: #9a9a9a; background-color: #fafafa; } footer a{ color: #9a9a9a; } /* HEADER */ header{ width: 760px; margin: auto; height: 50px; border-bottom: 1px solid #f1f1f1; position: relative; } #more-nav{ font-size: 0.75em; display: inline-block; position: absolute; top: 0px; font-family: "anonymousregular"; padding-top: 5px; right: 0px; } #more-nav a{ padding: 0px 2px; text-decoration: none; color: #353535; } #more-nav a:hover{ transition: 0s; background-image: linear-gradient(to bottom, #fff 30%, rgba(200, 200, 200, 0.4) 50%); background-repeat: repeat-x; background-size: 2px 2px; background-position: 0px 100%; } #more-nav .selected{ color: #ed5252; font-weight: bold; } #logo{ font-size: 1.2em; font-family: "anonymousregular"; margin-top: 20px; } #logo *{ text-decoration: none; } #logo1{ color: #999; } #logo2{ font-size: 0.8em; color: #ed5252; } #logo3{ color: #353535; } #logo a:hover{ color: #ed5252; transition-duration: 1s; } /* TEXT STRUCTURE */ h1, h2, h3, h4, h5{ font-family: 'Open Sans', sans-serif; color: #1c1c1c; } a:hover{ color: #ed5252; transition-duration:0.2s; } p a, ul a, .review a{ color: #763232; text-decoration: none; background-image: linear-gradient(to bottom, #fff 30%, rgba(200, 200, 200, 0.4) 50%); background-repeat: repeat-x; background-size: 2px 2px; background-position: 0px 100%; } .homepage a{ color: #353535; } p{ text-align: justify; margin-bottom: 20px; } .excerpt p{ margin-bottom: 0px; } .footnote, .sidenote{ margin: 40px 0px; color: #858585; text-align: right; font-size: 0.9em; font-style: italic; } .image_notes{ text-align: center; color: #858585; font-size: 0.9em; margin: -5px 0px 15px 0px; } h1{ font-size: 2.45em; text-align: center; margin: 70px 0px 20px 0px; line-height : 1.5em; } h1 em{ color: #888; font-weight: normal; font-size: 0.8em; } h2{ font-size: 1.75em; margin: 50px 0px 50px 0px; line-height: 1.75em; } h2::before{ content: "#"; color: #ed5252; font-family: "anonymousregular"; display: inline-block; float: left; padding: 3px 10px 0px 0px; font-size: 0.7em; } h3{ font-size: 1.35em; margin-bottom: 20px; } h4{ font-size: 1.2em; margin-bottom: 20px; font-style: italic; } h5{ font-size: 1.3em; margin-bottom: 20px; } h5 *{ color: #353535; } em{ font-style: italic; } strong{ font-weight: bold; } blockquote{ border-left: 3px solid #ddd; color: #888; margin: 0px 0px 20px 40px; font-style: italic; } blockquote p{ margin: 5px 20px !important; } ul{ padding-left: 40px; line-height: 25px; list-style: square; margin-bottom: 20px; } li{ display: list-item; } ol{ padding-left: 40px; line-height: 25px; margin-bottom: 20px; list-style-type: decimal; } /* TAGS */ .home-tag { font-size: 10px; display: inline-block; border: 1px solid #dedede; padding: 2px 2px 1px 2px; border-radius: 2px; line-height: 10px; margin-left: 1px; } .tag-date{ color: #aaa; } .tag-management { border-color: #929aff; color: #929aff; } .tag-programming { border-color: #ff9292; color: #ff9292; } .tag-coaching { border-color: #4ec698; color: #4ec698; } .tag-projectmanagement { border-color: #929aff; color: #929aff; } /* BLOG INDEX */ #all-posts{ margin: 0px auto 10px auto; width: 760px; } .single-post{ border-top: 1px solid #f1f1f1; padding: 40px 0px; float: clear; } .single-post:first-child{ border-top: none !important; } .single-post .date{ color: #cdcdcd; margin-top: 10px; float: right; } .single-post .author{ color: #cdcdcd; float: right; font-size: 0.7em; } .single-post .title{ font-family: 'Open Sans', sans-serif; font-size: 1.6em; margin-bottom: 20px; line-height: 1.6em; position: relative; } .single-post .title a{ color: #353535; text-decoration: none; } .single-post .title a::before{ content: "→"; opacity: 0; font-family: "anonymousregular"; font-size: 0.7em; position: absolute; left: -30px; transition: all .4s ease-in-out; } .single-post .title a:hover::before{ opacity: 1; transition: all .4s ease-in-out; color: #ed5252; } .single-post .title em{ display: none; } .data_table{ border: 1px solid #efefef; font-family: "anonymousregular"; font-size: 12px; margin: auto auto 20px auto; } .data_table tr{ border: 1px solid #efefef; } .data_table th{ background-color: #efefef; } .data_table th, .data_table td{ padding: 2px 5px; } .post table { margin: 0px auto 20px auto; border: 1px solid #dedede; } .post td { padding: 5px 10px; } /* BOOKS */ .book-cover-entry{ width: 120px; margin-right: 20px; float: left; font-size: 12px; text-decoration: none !important; } .buy-book{ text-decoration: underline; } .book-cover-entry img{ width: 120px; } .book-cover-entry { background-image: none; } .book-rating .icon { display: inline-block; padding-right: 5px; } .book-rating .top .icon{ color: #1CED00; } .book-rating .good .icon{ color: #82ED00; } .book-rating .medium .icon{ color: #EDD100; } .book-rating .low .icon{ color: #EDAE00; } .book-rating .poor .icon{ color: #ED3B00; } #buy-title{ padding: 0px 0px 25px 0px; } #buy-title span{ font-size: 0.8em !important; color: #cdcdcd; } #buy-popin{ padding: 30px 15px; } .store{ display: block; padding: 15px 5px; text-decoration: none; } .store:hover{ color: #ed5252; } #upcoming-books{ padding-top: 20px; } #upcoming-books img{ height: 90px; margin-right: 10px; border: 1px solid #fff; } #upcoming-books a{ text-decoration: none; } #upcoming-books img:hover{ border: 1px solid #ed5252; } /* BLOG SHOW */ .post{ } p code, li code{ background-color: #efefef; font-family: "Lucida Console", "Courier New", Courier, monospace; padding: 1px 2px; font-size: 13px; } .post img{ border: 1px solid #e6e6e6; padding: 5px; margin: 0px 0px 20px 20px; } .published span{ border-top: 1px solid #e6e6e6; display: inline-block; color: #858585; padding-top: 5px; font-family: 'Open Sans', sans-serif; font-size: 0.9em; padding: 5px 20px 0px 20px; } .published{ text-align: center; margin-bottom: 65px; } #more{ border-top: 1px solid #e6e6e6; margin-top: 40px; padding: 40px 0px; } #more-articles{ margin-bottom: 40px; } .image-wrapper em{ display: block; font-size: 0.8em; margin: -20px 0px 20px 0px; color: #aaa; } .image-wrapper em a{ color: #aaa; } .twitter-tweet{ margin: auto; max-width: 420px !important; } #book-review{ border: 1px dashed #dedede; padding: 20px; margin-bottom: 20px; opacity: 0.7; } #book-review a{ color: #763232; } /* Music */ .js_play_sound, .js_stop_sound{ display: inline-block; padding: 4px 10px 2px 10px; border: 1px solid #efefef; background-color: #efefef; margin-right: 10px; text-decoration: none; border-radius: 3px; font-family: 'anonymousregular'; font-size: 12px; } .js_play_sound:hover, .js_stop_sound:hover{ background-color: #dedede; } /* Comments */ #comments{ padding-top: 20px; } #show-disqus-arrow{ color: #ed5252; } /* CLEARFIX */ .cf:before, .cf:after { content: " "; /* 1 */ display: table; /* 2 */ } .cf:after { clear: both; } /************************ MOBILE LAYOUT *********************/ @media all and (max-width: 800px) { .home-tag { display: none; } .author{ float: none !important; display: inline; } header{ width: 92%; padding: 4%; height: 75px; position: relative; text-align: center; background-color: #fafafa; } #more-nav{ left: 0px; top: 50px; } #logo{ margin-top: 10px; } #content, #all-posts{ width: 92%; padding: 4%; } .image-wrapper{ width: 100%; } .image-wrapper img, .post div img, .post p img{ max-width: 100% !important; padding: 15px 0px !important; margin: 20px 0px 20px 0px !important; border-right: 0px; border-left: 0px; } .single-post .title{ font-size: 1.4em; } .date{ display: none; } h1{ font-size: 1.7em; width: 94%; padding: 3%; } h2{ font-size: 1.50em; margin: 30px 0px 30px 0px; line-height: 1.75em; } h3{ font-size: 1.30em; } blockquote{ margin: 0px 0px 20px 0px !important; } pre{ margin-left: 0px !important; margin-right: 0px !important; width: 90%; overflow-x: scroll; } code{ width: 100%; font-size: 13px !important; } footer div{ display: inline; } /* Hire me responsive */ #hire ul{ padding-left: 15px; } #talking-img{ width: 100%; } #talking-img img{ width: 100% !important; } #reviews{ border-top: 1px dashed #e6e6e6; padding: 15px 0px 15px 0px; } #references_logo{ padding: 0px 0px 15px 0px; } .review{ width: 100%; margin: 0px 0px 15px 0px; padding: 0px; border-bottom: 1px dashed #e6e6e6; } #references_logo img, #references_logo .minor{ width: 22%; float: left; margin: 15px 2% 15px 0px; } .data_table th, .data_table td{ font-size: 8px; padding: 0px; border: 1px solid #efefef; } } /* CONVERSATION */ #post-conversation blockquote{ color: rgb(84, 84, 84); font-style: normal; margin: 20px 40px; } #post-conversation blockquote p{ margin: 10px 20px !important; } #post-conversation blockquote .dpm{ color: #3B9E2E !important; font-family: 'Open Sans', sans-serif; font-size: 13px; } #post-conversation blockquote .ddev{ color: #AD34CF !important; font-family: 'Open Sans', sans-serif; font-size: 13px; } #post-conversation blockquote .dcto{ color: #9E2E2E !important; font-family: 'Open Sans', sans-serif; font-size: 13px; } /* STATUS */ .status { background-color: #fff; padding: 40px; border: 1px solid #dba9a9; border-radius: 5px; margin: 40px 0px; } .status_text_content { font-size: 22px; line-height: 32px; } .status_text_content p { text-align: start !important; } .status_date { } .status_date a { color: #858585; text-decoration: none; } .status_images { margin: 20px auto; text-align: center; } .status_images img { max-width: 85%; max-height: 500px; </style> </head> <body> <div id="gradient"></div> <header> <div id="logo"> <a id='logo1' href="/">marcgg</a> <span id='logo2'>#</span> <a id='logo3' href="/blog/"> blog </a> </div> <div id="more-nav"> &rarr; <a href="/blog/" class="selected">blog</a> &rarr; <a href="/status/" class="">status</a> &rarr; <a href="/books/" class="">books</a> &rarr; <a href="/hire/" class="">hire me</a> </div> </header> <h1> <span> Generating Custom Image Previews For Social Media </span> </h1> <div class="published"> <span>22 April 2020</span> </div> <div id="container"> <div id="content"> <div class="post" id="post-"> <p>When sharing a link on social media, the site often displays an image to make it more appealing. However on my blog I decided to keep things simple, often not having any header image or illustrations. This means my blog is <a href="/assets/blog/pagespeed_marcgg.png">faster to load</a> and I don’t spend time browsing stock picture websites to find something somewhat related to what I’m talking about.</p> <p>The problem is that in most cases sharing my articles will look like this:</p> <div class="image-wrapper" style="text-align: center"><img src="/assets/blog/preview_fail.png" alt="Social media preview" style="padding: 5px; width: 500px" /></div> <p>It’s not that bad, but after years I decided to do something about it. Of course I could open Photoshop, create a few images and call it a day, but that <s>would be way too simple</s> wouldn’t scale™.</p> <h2 id="making-it-look-nice">Making It Look Nice</h2> <p>I’m a terrible visual designer, so I needed to do something simple. I also wanted to avoid only having a random stock picture of people in suits shaking hands or a sunset, and instead have something more customised. I figured a way to go about it would be to generate an image with some text on top of some kind of background.</p> <h3 id="tweaking-stock-images">Tweaking Stock Images</h3> <p>There are a lot of good quality stock images out there. My issue with them is that they look very generic. In order to make them appear more distinct, I decided to run a selection through <a href="https://duotone.shapefactory.co/">Duotone</a> to make them match the simplistic color palette of my blog.</p> <div class="image-wrapper" style="text-align: center"><img src="/assets/blog/preview_duotone.jpg" alt="Using duotone" style="padding: 5px; width: 700px" /></div> <p>There’s not much color on my blog, but I do have a gradient on top of the page (wow!). I decided to turn use this gradient to add a border. I made a quick photoshop template and processed a bunch of duotoned stock images through it. I also added a small Gaussian blur to the images so that they don’t take the attention away from the text.</p> <div class="image-wrapper" style="text-align: center"><img src="/assets/blog/photoshop-template.png" alt="Simple photoshop template" style="padding: 5px; width: 700px" /></div> <p>Once I ran through this process a couple of times, I realised that I really didn’t like to do it. I also didn’t want to find a new image and go through this whenever I wrote a new article. The value added is small, and I much prefer focusing on writing things than optimise my social media presence. So instead I used the category system already in place in my blog and created a background per category.</p> <div class="image-wrapper" style="text-align: center"><img src="/assets/blog/category_backgrounds.png" alt="Tagging system and backgrounds" style="padding: 5px;" /></div> <p>This way all “Management” articles will have the same background, saving me the trouble of building a new image for each article. This feels fine to me because the images will be customised with the preview text.</p> <h3 id="adding-text">Adding Text</h3> <p>At first I wanted to display the article’s title. However some of them were very long and I would have to make the font very small to get the text to fit. Doing this was also just repeating what was displayed in the linked title below, not bringing anything new.</p> <p>I decided instead to write a new “preview title”, which would be a way smaller version of the main article title. For instance “Engineering Team Meeting: Format &amp; Topic Ideas” would become “Engineering Team Meeting”. In the future I will also try to experiment with catchier titles for this image and see how this performs.</p> <h3 id="the-result">The Result</h3> <p>There are of course a lot to improve, including finding better photos, adjusting the duotone contrast, making the border look nicer… but I think that’s an improvement over having no image at all so I’ll keep it for now!</p> <h4 id="seen-on-twitter">Seen On Twitter</h4> <div class="image-wrapper" style="text-align: center"><img src="/assets/blog/preview_example.png" alt="Social media preview" style="padding: 5px; width: 500px" /></div> <h4 id="a-few-examples">A Few Examples</h4> <div class="image-wrapper" style="text-align: center"><img src="/assets/blog/result_preview.jpg" alt="Social media preview" style="padding: 5px; width: 750px" /></div> <h2 id="how-to-automate">How to Automate</h2> <p>Since I didn’t want to generate images manually using Photoshop each time I wrote a new article, I created a small Ruby script to do it for me.</p> <h3 id="figuring-out-what-text-to-write">Figuring Out What Text To Write</h3> <p>I use <a href="https://jekyllrb.com/">Jekyll</a> for my blog, meaning that all my articles are written in markdown and have a set of customisable attributes. I used this fact and added a “social media preview” attribute to the <a href="https://jekyllrb.com/docs/front-matter/">front matter</a> section of the articles.</p> <p>To illustrate, here is how my <a href="/blog/2020/04/14/creating-my-manager-readme/">Manager README article</a>’s attributes look like:</p> <div class="image-wrapper" style="text-align: center"><img src="/assets/blog/front-matter.png" alt="Markdown header example" style="padding: 5px;" /></div> <p>Once I decided on the format, and went back and wrote the preview text, I needed to programatically go through all articles and find the category and tag.</p> <p>At first I wanted to load up Jekyll to use their parsing capabilities, but it turned out to be more painful than expected. To move faster and save me the headaches, I went back to regular expressions. This is obviously less than optimal, but it did the trick.</p> <p>Note that I also kept the posts’ file names as their unique identifier.</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">FOLDER_PATH</span> <span class="o">=</span> <span class="s2">"../_posts/"</span>
<span class="no">MESSAGE_PATTERN</span> <span class="o">=</span> <span class="sr">/^socialmediapreview: "([&amp;a-zA-Z0-9]()_ !\/\?\.:;=+$%éèà\-']*)"$/</span>
<span class="no">TAG_PATTERN</span> <span class="o">=</span> <span class="sr">/^tag: "?([&amp;a-zA-Z0-9]()_ ]*)"?$/</span>

<span class="no">Dir</span><span class="p">.</span><span class="nf">entries</span><span class="p">(</span><span class="no">FOLDER_PATH</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span>
  <span class="n">file_name</span> <span class="o">=</span> <span class="n">file</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">gsub</span><span class="p">(</span><span class="s2">".md"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
  <span class="n">file_data</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="no">FOLDER_PATH</span> <span class="o">+</span> <span class="n">file</span><span class="p">)</span>
  <span class="n">msg</span> <span class="o">=</span> <span class="n">file_data</span><span class="p">.</span><span class="nf">match</span><span class="p">(</span><span class="no">MESSAGE_PATTERN</span><span class="p">)</span>
  <span class="n">tag</span> <span class="o">=</span> <span class="n">file_data</span><span class="p">.</span><span class="nf">match</span><span class="p">(</span><span class="no">TAG_PATTERN</span><span class="p">)</span>
  <span class="n">generate_image</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tag</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="k">end</span></code></pre></figure> <h3 id="adding-text-over-an-image-programatically">Adding Text Over an Image Programatically</h3> <p>To generate the images I used ImageMagick. I described this process in more details in this article: <a href="/blog/2020/04/11/add-text-image-rmagick-imagemagick/">Add Text Over an Image with Ruby</a>.</p> <h4 id="figuring-out-font-size">Figuring Out Font Size</h4> <p>I wanted the text to take up as much space as possible, but since all the preview messages would be different, it wouldn’t make sense to just have one font size. To solve this, I came up with this small tweak based on text length that worked for my situation:</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">txt</span><span class="p">.</span><span class="nf">pointsize</span> <span class="o">=</span> <span class="mi">175</span> <span class="o">-</span> <span class="n">message</span><span class="p">.</span><span class="nf">size</span><span class="o">*</span><span class="mi">4</span></code></pre></figure> <p>This is not perfect since, in non fixed-spaced fonts, letters like<code class="language-plaintext highlighter-rouge">M</code> and <code class="language-plaintext highlighter-rouge">W</code> are way bigger than <code class="language-plaintext highlighter-rouge">i</code> or <code class="language-plaintext highlighter-rouge">l</code>… but this solution seemed a decent in between. To improve, I should add a lenght factor depending on the type of characters in the message.</p> <h4 id="generating-the-images">Generating The Images</h4> <p>The whole thing is pretty straightforward, basically calling this <code class="language-plaintext highlighter-rouge">generate_image(file_name, message, tag)</code> method containing the following:</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">img</span> <span class="o">=</span> <span class="no">Magick</span><span class="o">::</span><span class="no">ImageList</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"./backgrounds/</span><span class="si">#{</span><span class="n">tag</span><span class="p">.</span><span class="nf">downcase</span><span class="si">}</span><span class="s2">.jpg"</span><span class="p">)</span>
<span class="n">txt</span> <span class="o">=</span> <span class="no">Magick</span><span class="o">::</span><span class="no">Draw</span><span class="p">.</span><span class="nf">new</span>
<span class="n">img</span><span class="p">.</span><span class="nf">annotate</span><span class="p">(</span><span class="n">txt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">txt</span><span class="p">.</span><span class="nf">gravity</span> <span class="o">=</span> <span class="no">Magick</span><span class="o">::</span><span class="no">CenterGravity</span>
  <span class="n">txt</span><span class="p">.</span><span class="nf">pointsize</span> <span class="o">=</span> <span class="mi">175</span> <span class="o">-</span> <span class="n">message</span><span class="p">.</span><span class="nf">size</span><span class="o">*</span><span class="mi">4</span>
  <span class="n">txt</span><span class="p">.</span><span class="nf">fill</span> <span class="o">=</span> <span class="s2">"#1c1c1c"</span>
  <span class="n">txt</span><span class="p">.</span><span class="nf">font</span> <span class="o">=</span> <span class="s2">"/path/to/font/OpenSans-ExtraBold.ttf"</span>
  <span class="n">img</span><span class="p">.</span><span class="nf">format</span> <span class="o">=</span> <span class="s2">"jpeg"</span>
<span class="k">end</span>
<span class="n">img</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s2">"../assets/previews/</span><span class="si">#{</span><span class="n">file_name</span><span class="si">}#{</span><span class="no">EXTENSION</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span></code></pre></figure> <p>Once this is done I can just run the script and it will regenerate all the preview images.</p> <h3 id="letting-twitterlinkedinfacebook-know">Letting Twitter/Linkedin/Facebook Know</h3> <p>Finally, once the assets were generated, I needed to make the information available to the social media platforms. I didn’t want to actually display the image on the articles, so I only put the information in the header of all my post articles using the <code class="language-plaintext highlighter-rouge">og:image</code> tag <a href="https://developers.facebook.com/docs/sharing/webmasters/#markup">as described here</a>.</p> <div class="image-wrapper" style="text-align: center"><img src="/assets/blog/setup_card.png" alt="Setup card header" style="padding: 5px; width: 90%" /></div> <p>To know if the assets were properly read, I had to use each platform’s debugger tool:</p> <ul> <li><a href="https://developers.facebook.com/tools/debug/">Facebook Sharing Debugger</a></li> <li><a href="https://www.linkedin.com/post-inspector/">Linked Post Inspector</a></li> <li><a href="https://cards-dev.twitter.com/validator">Twitter Card Validator</a></li> </ul> <p>Debugging this part was a bit annoying as I needed to push a release every time to see if the various sites understood my changes. I could have setup some kind of tunnel or use <a href="https://ngrok.com/">ngrok</a> but I got lazy which ended up costing me more time. Platforms like Twitter also had a very weird cache management system which made the whole process last way more painful than it should have been.</p> <h2 id="conclusion">Conclusion</h2> <p>The whole image generation process is now working fine - maybe you even came to this article through a link featuring one of these previews!</p> <p>It obviously took me more time to automate than to do manually, but it was way more fun to do it this way :) I also believe that <a href="/blog/2015/09/30/automate-repetitive-tasks/">time spent is not the only measure triggering a need for automation</a>.</p> <p>A few things that I should improve:</p> <ul> <li>Make it look better. Clearly the border is not as cool looking as I wanted, the duotone colors could be nicer… on this part I know that I’ll need help :)</li> <li>Trigger the script automatically on file change instead of manually before releasing.</li> <li>Refactor the script a bit, making it cleaner and more defensive. I could also figure out a way to not regenerate all images each time, with some state management.</li> <li>Use proper parsing instead of regular expressions.</li> <li>Have a better local setup to work with this, probably with a tunnel to get quicker feedback from social media sites.</li> </ul> <div id="more"> <div id="more-articles"> <p>Since you scrolled this far, you might be interested in some other things I wrote:</p> <ul> <li><a href="/blog/2013/05/20/track-link-clicks/">Information About Bots & People Clicking a Link</a></li> <li><a href="/blog/2012/12/10/angelhack-third-place-paris-hackathon/">How We Made Third Place At AngelHack Paris</a></li> <li><a href="/blog/2012/01/09/start-working-on-your-side-project/">Start Working on Your Side Project Tonight</a></li> <li><a href="/books/">Startup & Tech Book Reviews</a> </ul> </div> <div class="container comments" id="comments"> Loading comments... </div> <div id="comment_form_wrapper" class="container"> <form id="comment_form"> <textarea name="content" required id="comment_content" placeholder="Leave a comment"/></textarea /> <div id="comment_additional" class="row" style="display: none;"> <div class="col-sm-4"> <input type="text" id="comment_name" required placeholder="Your name*" /> </div> <div class="col-sm-4"> <input type="text" id="comment_website" placeholder="Your site" /> </div> <div class="col-sm-4"> <input type="email" id="comment_email" required placeholder="Your email* (won't be displayed)" /> </div> </div> <br /> <input type="submit" id="submit_comment" value="Send"/> <div id="submit_loading" style="display: none;">...</div> </form> </div> </div> </div> </div> </div> <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script> <script src="/assets/js/comments.js"></script> <link rel="preload" href="/assets/css/code.css" as="style" onload="this.rel='stylesheet'"> <link href="/assets/css/comments.css?body=1" rel="stylesheet" type="text/css" media="all"> <script> /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */ !function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this); /*! loadCSS rel=preload polyfill. [c]2017 Filament Group, Inc. MIT License */ !function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this); </script> <footer> <div>Website powered by <a href="https://github.com/jekyll/jekyll">Jekyll</a>, hosted on <a href="https://github.com/marcgg/marcgg.github.com">Github</a>. <br> All of the <a href="/blog">blog's articles</a>, <a href="/status">status</a> and site content in general is under Copyright &copy;. <br> If you want to use this content, please contact me.</div> </footer> <script type="text/javascript"> var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-31071519-1']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })(); </script> </body> </html>

